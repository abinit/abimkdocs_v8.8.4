



<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="Abinit documentation">
      
      
        <link rel="canonical" href="https://docs.abinit.org/tutorial/ffield/">
      
      
        <meta name="author" content="The Abinit group">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../images/favicon.ico">
      <meta name="generator" content="mkdocs-0.17.2, mkdocs-material-2.6.6">
    
    
      
        <title>Ffield - abinit</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.78aab2dc.css">
      
        <link rel="stylesheet" href="../../assets/stylesheets/application-palette.6079476c.css">
      
    
    
    
      <script src="../../assets/javascripts/modernizr.1aa3b519.js"></script>
    

    <!-- Jquery from Google CDN -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

    <!-- Load Jquery UI -->
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>
    <!-- Handle jQuery plugin naming conflict between jQuery UI and Bootstrap 
    https://stackoverflow.com/questions/13731400/jqueryui-tooltips-are-competing-with-twitter-bootstrap
    -->
    <script>
      $.widget.bridge('uibutton', $.ui.button);
      $.widget.bridge('uitooltip', $.ui.tooltip);
    </script>

    <!--
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/smoothness/jquery-ui.css">
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/pepper-grinder/jquery-ui.css">
    -->
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">

    <!-- Bootstrap theme -->
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/alertifyjs@1.11.0/build/css/themes/bootstrap.min.css"/>

    <!-- Bootstrap http://getbootstrap.com/getting-started/ -->
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" 
    integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

    <!-- Optional theme -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" 
    integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">

    <!-- Latest compiled and minified JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" 
    integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous">
    </script>

    <!-- font-awesome -->
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">

    

    <!--Pace support. http://github.hubspot.com/pace/ -->
    <script>
        paceOptions = {
            ajax: true,      // disabled
            document: true,  // activated
            eventLag: false  // disabled
            //target: 'article'
            //elements: {selectors: ['.my-page']}
        };
    </script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.0.2/pace.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.0.2/themes/white/pace-theme-big-counter.min.css" />
    <!--
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.0.2/themes/white/pace-theme-bounce.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.0.2/themes/blue/pace-theme-corner-indicator.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.0.2/themes/blue/pace-theme-flat-top.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.0.2/themes/blue/pace-theme-loading-bar.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.0.2/themes/blue/pace-theme-center-atom.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.0.2/themes/blue/pace-theme-flash.min.css" />
    -->

    <!-- MathJax support
    <script type="text/javascript" async 
        src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML">
    </script> 
    -->
    <!--
    This is compatible with plotly.
    -->
    <script type="text/javascript" async 
        src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_SVG">
    </script> 

    <!--
    Configure MathJax to produce automatic equation numbers http://docs.mathjax.org/en/latest/tex.html
    -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        //jax: ["input/TeX","output/HTML-CSS"],
        //tex2jax: {inlineMath: [['$','$']]},
        //displayAlign: "center",
        TeX: {
            equationNumbers: { autoNumber: "AMS" },
            extensions: ["AMSmath.js"],
            Macros: {
                "*": "{\\dagger}",
                "ra": "{\\rangle}",
                "la": "{\\langle}",
                // matchcal version
                mcG: "{\\mathcal{G}}",
                mcR: "{\\mathcal{R}}",
                mcS: "{\\mathcal{S}}",
                mcC: "{\\mathcal{C}}",
                mcO: "{\\mathcal{O}}",
                // acronyms
                KS: "{\\text{KS}}",
                QP: "{\\text{QP}}",
                BZ: "{\\text{BZ}}",
                sign: "{\\text{sign}}",
                xc: "{\\text{xc}}",
                tchi: "{\\tilde\\chi}",
                // symbols commonly used
                rr: "{\\bf r}",
                RR: "{\\bf R}",
                tt: "{\\bf t}",
                GG: "{\\bf G}",
                kk: "{\\bf k}",
                qq: "{\\bf q}",
                kq: "{\\kk + \\qq}",
                qG: "{\\bf q + G}",
                kmq: "{\\kk - \\qq}",
                kpq: "{\\kk + \\qq}",
                kpG: "{\\kk + \\GG}",
                qpG: "{\\qq + \\GG}",
                // Many-body theory
                Go: "{G_0}",
                Wo: "{W_0}",
                Ueff: "{U_{\\text{eff}}}",
                // greek symbols + tilde version
                ee: "{\\epsilon}",
                tee: "{\\tilde{\\epsilon}}",
                ww: "{\\omega}",
                tww: "{\\tilde\\omega}",
                dd: "{\\,\\text{d}}",
                vxc: "{v_\\xc}",
                // symrel
                Ri: "{\\mcR^{-1}}",
                Rit: "{\\mcR^{-1\\tau}}",
                // symrec
                Si: "{\\mcS^{-1}}}",
                Sit: "{\\Si^\\tau}}",
                // partial and functional derivative.
                PDER: ["{\\dfrac{\\partial #1}{\\partial #2}}", 2],
                FDER: ["{\\dfrac{\\delta #1}{\\delta #2}}", 2],
                // PAW
                tPsi: "{\\tilde\\Psi}",
                tpsi: "{\\tilde\\psi}",
                tPhi: "{\\tilde\\Phi}",
                tphi: "{\\tilde\\phi}",
                tprj: "{\\tilde p}"
            }
          }
      });
    </script>

    <!-- See http://docs.mathjax.org/en/latest/start.html 
    <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        extensions: ["tex2jax.js", "MathMenu.js", "MathZoom.js"],
        jax: ["input/TeX", "output/HTML-CSS", "output/NativeMML],
        tex2jax: {
            inlineMath: [ ['$','$'], ["\\(","\\)"] ],
            displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
            processEscapes: true
        },
        "HTML-CSS": { availableFonts: ["TeX"] }
      });
    </script>
    -->

    
    
    

    <!-- Introjs for Guided Tour -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/intro.js/2.7.0/intro.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/intro.js/2.7.0/introjs.min.css" />

    <!-- Load fonts used for input variables -->
    <!--
    <link href="https://fonts.googleapis.com/css?family=Ubuntu+Mono" rel="stylesheet">
    -->
    <link href="https://fonts.googleapis.com/css?family=Inconsolata" rel="stylesheet">

    
      <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
      
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    
    
      <link rel="stylesheet" href="../../css/extra.css">
    
      <link rel="stylesheet" href="../../css/gallery.css">
    
      <link rel="stylesheet" href="../../css/my_codehilite.css">
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="deep-orange" data-md-color-accent="deep-orange">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="drawer">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="search">
    <label class="md-overlay" data-md-component="overlay" for="drawer"></label>
    
      <a href="#lesson-on-polarization-and-finite-electric-fields" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="https://www.abinit.org" title="abinit" class="md-header-nav__button md-logo">
          
            <img src="../../images/logo-abinit-2015.png" width="48" height="48">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <span class="md-flex__ellipsis md-header-nav__title">
          
            
              
                <span class="md-header-nav__parent">
                  Lessons
                </span>
              
                <span class="md-header-nav__parent">
                  DFPT
                </span>
              
            
            Ffield
          
        </span>
      </div>
      <!-- Guided Tour with introjs. Add glow effect to button only if homepage -->
      <div class="md-flex__cell md-flex__cell--shrink">
           
          
          <a href="#" class="btn btn-xs btn-default  " id="guided-tour-button" title="Guided Tour" 
              onclick="abidocs_guidedtour()">
           <span class="fa fa-info-circle"></span></a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  


  <a href="https://github.com/abinit/abinit/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      github-abinit
    </div>
  </a>

          </div>
        </div>
      
      <div class="md-flex__cell md-flex__cell--shrink" id="previous_published_versions">
        <div class="dropdown">
          <button class="btn btn-basic btn-sm dropdown-toggle" type="button" data-toggle="dropdown">
            8.8.4
          <span class="caret"></span></button>
          <ul class="dropdown-menu">
            
          </ul>
        </div>
      </div>

    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
        

  

<nav class="md-tabs md-tabs--active" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../.." title="User Guide" class="md-tabs__link">
          User Guide
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../topics/features/" title="Topics" class="md-tabs__link">
          Topics
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../variables/" title="Variables" class="md-tabs__link">
          Variables
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../" title="Lessons" class="md-tabs__link md-tabs__link--active">
          Lessons
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../theory/geometry/" title="Theory" class="md-tabs__link">
          Theory
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../developers/abimkdocs/" title="Developers" class="md-tabs__link">
          Developers
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../about/release-notes/" title="About" class="md-tabs__link">
          About
        </a>
      
    </li>
  

      
    </ul>
  </div>
</nav>
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="drawer">
    <span class="md-nav__button md-logo">
      
        <img src="../../images/logo-abinit-2015.png" width="24" height="24">
      
    </span>
    abinit
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/abinit/abinit/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      github-abinit
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-1" type="checkbox" id="nav-1">
    
    <label class="md-nav__link" for="nav-1">
      User Guide
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-1">
        User Guide
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../.." title="NewUser" class="md-nav__link">
      NewUser
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../guide/abinit/" title="Abinit" class="md-nav__link">
      Abinit
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../guide/aim/" title="Aim" class="md-nav__link">
      Aim
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../guide/anaddb/" title="Anaddb" class="md-nav__link">
      Anaddb
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../guide/cut3d/" title="Cut3d" class="md-nav__link">
      Cut3d
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../guide/fold2bloch/" title="Fold2Bloch" class="md-nav__link">
      Fold2Bloch
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../guide/mrgddb/" title="Mrgddb" class="md-nav__link">
      Mrgddb
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../guide/mrgscr/" title="Mrgscr" class="md-nav__link">
      Mrgscr
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../guide/optic/" title="Optic" class="md-nav__link">
      Optic
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../guide/respfn/" title="Respfn" class="md-nav__link">
      Respfn
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../guide/spacegroup/" title="Spacegroup" class="md-nav__link">
      Spacegroup
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-1-12" type="checkbox" id="nav-1-12">
    
    <label class="md-nav__link" for="nav-1-12">
      Installation
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-1-12">
        Installation
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../installation/" title="HowTo" class="md-nav__link">
      HowTo
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../README_MacOSX/" title="MacOSX" class="md-nav__link">
      MacOSX
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../README_gpu/" title="GPUs" class="md-nav__link">
      GPUs
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../README_xlf/" title="Xlf" class="md-nav__link">
      Xlf
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Topics
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Topics
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/features/" title="Features" class="md-nav__link">
      Features
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/" title="Topic List" class="md-nav__link">
      Topic List
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/Abipy/" title="Abipy" class="md-nav__link">
      Abipy
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/APPA/" title="APPA" class="md-nav__link">
      APPA
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/Artificial/" title="Artificial" class="md-nav__link">
      Artificial
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/AtomManipulator/" title="AtomManipulator" class="md-nav__link">
      AtomManipulator
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/AtomTypes/" title="AtomTypes" class="md-nav__link">
      AtomTypes
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/Bader/" title="Bader" class="md-nav__link">
      Bader
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/Band2eps/" title="Band2eps" class="md-nav__link">
      Band2eps
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/Berry/" title="Berry" class="md-nav__link">
      Berry
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/BandOcc/" title="BandOcc" class="md-nav__link">
      BandOcc
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/BSE/" title="BSE" class="md-nav__link">
      BSE
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/ConstrainedPol/" title="ConstrainedPol" class="md-nav__link">
      ConstrainedPol
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/Control/" title="Control" class="md-nav__link">
      Control
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/Coulomb/" title="Coulomb" class="md-nav__link">
      Coulomb
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/CRPA/" title="CRPA" class="md-nav__link">
      CRPA
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/crystal/" title="Crystal" class="md-nav__link">
      Crystal
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/DFT+U/" title="DFT+U" class="md-nav__link">
      DFT+U
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/DeltaSCF/" title="DeltaSCF" class="md-nav__link">
      DeltaSCF
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/DensityPotential/" title="DensityPotential" class="md-nav__link">
      DensityPotential
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/Dev/" title="Dev" class="md-nav__link">
      Dev
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/DFPT/" title="DFPT" class="md-nav__link">
      DFPT
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/DMFT/" title="DMFT" class="md-nav__link">
      DMFT
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/EffMass/" title="EffMass" class="md-nav__link">
      EffMass
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/EFG/" title="EFG" class="md-nav__link">
      EFG
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/Elastic/" title="Elastic" class="md-nav__link">
      Elastic
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/ElPhonInt/" title="ElPhonInt" class="md-nav__link">
      ElPhonInt
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/ElPhonTransport/" title="ElPhonTransport" class="md-nav__link">
      ElPhonTransport
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/ElecDOS/" title="ElecDOS" class="md-nav__link">
      ElecDOS
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/ElecBandStructure/" title="ElecBandStructure" class="md-nav__link">
      ElecBandStructure
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/FileFormats/" title="FileFormats" class="md-nav__link">
      FileFormats
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/ForcesStresses/" title="ForcesStresses" class="md-nav__link">
      ForcesStresses
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/FrequencyMeshMBPT/" title="FrequencyMeshMBPT" class="md-nav__link">
      FrequencyMeshMBPT
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/GeoConstraints/" title="GeoConstraints" class="md-nav__link">
      GeoConstraints
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/GeoOpt/" title="GeoOpt" class="md-nav__link">
      GeoOpt
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/Git/" title="Git" class="md-nav__link">
      Git
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/GSintroduction/" title="GSintroduction" class="md-nav__link">
      GSintroduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/GW/" title="GW" class="md-nav__link">
      GW
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/GWls/" title="GWls" class="md-nav__link">
      GWls
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/Hybrids/" title="Hybrids" class="md-nav__link">
      Hybrids
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/k-points/" title="K points" class="md-nav__link">
      K points
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/LDAminushalf/" title="LDAminushalf" class="md-nav__link">
      LDAminushalf
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/LOTF/" title="LOTF" class="md-nav__link">
      LOTF
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/MagField/" title="MagField" class="md-nav__link">
      MagField
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/MagMom/" title="MagMom" class="md-nav__link">
      MagMom
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/MolecularDynamics/" title="MolecularDynamics" class="md-nav__link">
      MolecularDynamics
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/multidtset/" title="Multidtset" class="md-nav__link">
      Multidtset
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/nonlinear/" title="Nonlinear" class="md-nav__link">
      Nonlinear
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/Optic/" title="Optic" class="md-nav__link">
      Optic
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/Output/" title="Output" class="md-nav__link">
      Output
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/parallelism/" title="Parallelism" class="md-nav__link">
      Parallelism
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/PAW/" title="PAW" class="md-nav__link">
      PAW
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/PIMD/" title="PIMD" class="md-nav__link">
      PIMD
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/Planewaves/" title="Planewaves" class="md-nav__link">
      Planewaves
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/Phonons/" title="Phonons" class="md-nav__link">
      Phonons
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/PhononBands/" title="PhononBands" class="md-nav__link">
      PhononBands
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/PhononWidth/" title="PhononWidth" class="md-nav__link">
      PhononWidth
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/PortabilityNonRegression/" title="PortabilityNonRegression" class="md-nav__link">
      PortabilityNonRegression
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/positron/" title="Positron" class="md-nav__link">
      Positron
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/printing/" title="Printing" class="md-nav__link">
      Printing
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/PseudosPAW/" title="PseudosPAW" class="md-nav__link">
      PseudosPAW
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/q-points/" title="Q points" class="md-nav__link">
      Q points
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/RandStopPow/" title="RandStopPow" class="md-nav__link">
      RandStopPow
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/Recursion/" title="Recursion" class="md-nav__link">
      Recursion
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/RPACorrEn/" title="RPACorrEn" class="md-nav__link">
      RPACorrEn
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/SCFControl/" title="SCFControl" class="md-nav__link">
      SCFControl
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/SCFAlgorithms/" title="SCFAlgorithms" class="md-nav__link">
      SCFAlgorithms
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/SelfEnergy/" title="SelfEnergy" class="md-nav__link">
      SelfEnergy
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/SmartSymm/" title="SmartSymm" class="md-nav__link">
      SmartSymm
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/spinpolarisation/" title="Spinpolarisation" class="md-nav__link">
      Spinpolarisation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/STM/" title="STM" class="md-nav__link">
      STM
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/Susceptibility/" title="Susceptibility" class="md-nav__link">
      Susceptibility
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/TDDFT/" title="TDDFT" class="md-nav__link">
      TDDFT
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/TDepES/" title="TDepES" class="md-nav__link">
      TDepES
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/Temperature/" title="Temperature" class="md-nav__link">
      Temperature
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/TransPath/" title="TransPath" class="md-nav__link">
      TransPath
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/TuningSpeed/" title="TuningSpeed" class="md-nav__link">
      TuningSpeed
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/Unfolding/" title="Unfolding" class="md-nav__link">
      Unfolding
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/UnitCell/" title="UnitCell" class="md-nav__link">
      UnitCell
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/vdw/" title="Vdw" class="md-nav__link">
      Vdw
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/Verification/" title="Verification" class="md-nav__link">
      Verification
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/Wannier/" title="Wannier" class="md-nav__link">
      Wannier
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/Wavelets/" title="Wavelets" class="md-nav__link">
      Wavelets
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/xc/" title="Xc" class="md-nav__link">
      Xc
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../topics/external_resources/" title="External Resources" class="md-nav__link">
      External Resources
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Variables
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Variables
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../variables/" title="All Variables" class="md-nav__link">
      All Variables
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-2" type="checkbox" id="nav-3-2">
    
    <label class="md-nav__link" for="nav-3-2">
      Abinit
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-3-2">
        Abinit
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../variables/basic/" title="Basic" class="md-nav__link">
      Basic
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../variables/bse/" title="Bethe-Salpeter" class="md-nav__link">
      Bethe-Salpeter
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../variables/dev/" title="Developers" class="md-nav__link">
      Developers
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../variables/dmft/" title="DMFT" class="md-nav__link">
      DMFT
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../variables/eph/" title="Electron-Phonon" class="md-nav__link">
      Electron-Phonon
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../variables/ffield/" title="Varff" class="md-nav__link">
      Varff
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../variables/files/" title="File-handling" class="md-nav__link">
      File-handling
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../variables/geo/" title="Geometry" class="md-nav__link">
      Geometry
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../variables/gstate/" title="Ground-State" class="md-nav__link">
      Ground-State
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../variables/gw/" title="GW" class="md-nav__link">
      GW
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../variables/internal/" title="Internal" class="md-nav__link">
      Internal
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../variables/paral/" title="Parallelism" class="md-nav__link">
      Parallelism
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../variables/paw/" title="PAW" class="md-nav__link">
      PAW
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../variables/dfpt/" title="DFPT" class="md-nav__link">
      DFPT
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../variables/rlx/" title="Relaxation" class="md-nav__link">
      Relaxation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../variables/vdw/" title="VdW" class="md-nav__link">
      VdW
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../variables/w90/" title="Wannier90" class="md-nav__link">
      Wannier90
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../variables/anaddb/" title="Anaddb" class="md-nav__link">
      Anaddb
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../variables/optic/" title="Optic" class="md-nav__link">
      Optic
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../variables/aim/" title="Aim" class="md-nav__link">
      Aim
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../variables/external_parameters/" title="External Parameters" class="md-nav__link">
      External Parameters
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../variables/varset_stats/" title="Statistics" class="md-nav__link">
      Statistics
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4" checked>
    
    <label class="md-nav__link" for="nav-4">
      Lessons
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Lessons
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-2" type="checkbox" id="nav-4-2">
    
    <label class="md-nav__link" for="nav-4-2">
      Base Tutorials
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-4-2">
        Base Tutorials
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../base1/" title="Base1" class="md-nav__link">
      Base1
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../base2/" title="Base2" class="md-nav__link">
      Base2
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../base3/" title="Base3" class="md-nav__link">
      Base3
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../base4/" title="Base4" class="md-nav__link">
      Base4
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../spin/" title="Spin" class="md-nav__link">
      Spin
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-3" type="checkbox" id="nav-4-3">
    
    <label class="md-nav__link" for="nav-4-3">
      PAW
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-4-3">
        PAW
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../paw1/" title="PAW1" class="md-nav__link">
      PAW1
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../paw2/" title="PAW2" class="md-nav__link">
      PAW2
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../paw3/" title="PAW3" class="md-nav__link">
      PAW3
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-4" type="checkbox" id="nav-4-4">
    
    <label class="md-nav__link" for="nav-4-4">
      DFT_PLUS_U
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-4-4">
        DFT_PLUS_U
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../dftu/" title="Dftu" class="md-nav__link">
      Dftu
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../udet/" title="Udet" class="md-nav__link">
      Udet
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../ucalc_crpa/" title="Ucalc crpa" class="md-nav__link">
      Ucalc crpa
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-5" type="checkbox" id="nav-4-5" checked>
    
    <label class="md-nav__link" for="nav-4-5">
      DFPT
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-4-5">
        DFPT
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../rf1/" title="RF1" class="md-nav__link">
      RF1
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../rf2/" title="RF2" class="md-nav__link">
      RF2
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../elastic/" title="Elastic" class="md-nav__link">
      Elastic
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="toc">
        Ffield
      </label>
    
    <a href="./" title="Ffield" class="md-nav__link md-nav__link--active">
      Ffield
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#polarization-and-responses-to-finite-electric-fields-for-alas" title="Polarization, and responses to finite electric fields for AlAs." class="md-nav__link">
    Polarization, and responses to finite electric fields for AlAs.
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#1-ground-state-properties-of-alas-and-general-parameters" title="1 Ground-state properties of AlAs and general parameters" class="md-nav__link">
    1 Ground-state properties of AlAs and general parameters
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-berry-phase-calculation-of-polarization-in-zero-field" title="2 Berry phase calculation of polarization in zero field" class="md-nav__link">
    2 Berry phase calculation of polarization in zero field
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-finite-electric-field-calculations" title="3 Finite electric field calculations" class="md-nav__link">
    3 Finite electric field calculations
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../nlo/" title="Nlo" class="md-nav__link">
      Nlo
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../dmft/" title="DMFT" class="md-nav__link">
      DMFT
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-7" type="checkbox" id="nav-4-7">
    
    <label class="md-nav__link" for="nav-4-7">
      EPH
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-4-7">
        EPH
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../eph/" title="Eph" class="md-nav__link">
      Eph
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../tdepes/" title="Tdepes" class="md-nav__link">
      Tdepes
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-8" type="checkbox" id="nav-4-8">
    
    <label class="md-nav__link" for="nav-4-8">
      Many-Body
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-4-8">
        Many-Body
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../gw1/" title="GW1" class="md-nav__link">
      GW1
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../gw2/" title="GW2" class="md-nav__link">
      GW2
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../bse/" title="Bethe-Salpeter" class="md-nav__link">
      Bethe-Salpeter
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-9" type="checkbox" id="nav-4-9">
    
    <label class="md-nav__link" for="nav-4-9">
      Parallelism
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-4-9">
        Parallelism
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../basepar/" title="Base" class="md-nav__link">
      Base
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../paral_gspw/" title="GSPW" class="md-nav__link">
      GSPW
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../paral_gswvl/" title="GSWVL" class="md-nav__link">
      GSWVL
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../paral_dfpt/" title="DFPT" class="md-nav__link">
      DFPT
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../paral_images/" title="Images" class="md-nav__link">
      Images
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../paral_mbt/" title="Many-Body" class="md-nav__link">
      Many-Body
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../paral_moldyn/" title="Moldyn" class="md-nav__link">
      Moldyn
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../analysis_tools/" title="Analysis tools" class="md-nav__link">
      Analysis tools
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../fold2bloch/" title="Fold2bloch" class="md-nav__link">
      Fold2bloch
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../nuc/" title="Nuc" class="md-nav__link">
      Nuc
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../optic/" title="Optic" class="md-nav__link">
      Optic
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../positron/" title="Positron" class="md-nav__link">
      Positron
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../source_code/" title="Source code" class="md-nav__link">
      Source code
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../tddft/" title="Tddft" class="md-nav__link">
      Tddft
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../wannier90/" title="Wannier90" class="md-nav__link">
      Wannier90
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Theory
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Theory
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../theory/geometry/" title="Geometry" class="md-nav__link">
      Geometry
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../theory/spherical_harmonics/" title="Spherical Harmonics" class="md-nav__link">
      Spherical Harmonics
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../theory/wavefunctions/" title="Wavefunctions" class="md-nav__link">
      Wavefunctions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../theory/noncollinear/" title="Noncollinear" class="md-nav__link">
      Noncollinear
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../theory/pseudopotentials/" title="Pseudopotentials" class="md-nav__link">
      Pseudopotentials
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../theory/mbt/" title="Many-Body Perturbation Theory" class="md-nav__link">
      Many-Body Perturbation Theory
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../theory/bse/" title="Bethe-Salpeter" class="md-nav__link">
      Bethe-Salpeter
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../theory/documents/" title="Documents" class="md-nav__link">
      Documents
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../theory/acknowledgments/" title="Acknowledgments" class="md-nav__link">
      Acknowledgments
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../theory/bibliography/" title="Bibliography" class="md-nav__link">
      Bibliography
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      Developers
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        Developers
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../developers/abimkdocs/" title="Abimkdocs" class="md-nav__link">
      Abimkdocs
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../developers/markdown/" title="Markdown" class="md-nav__link">
      Markdown
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../developers/testsuite/" title="Test Suite" class="md-nav__link">
      Test Suite
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6-4" type="checkbox" id="nav-6-4">
    
    <label class="md-nav__link" for="nav-6-4">
      Pseudos
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-6-4">
        Pseudos
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../developers/psp1_info/" title="psp1" class="md-nav__link">
      psp1
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../developers/psp3_info/" title="psp3" class="md-nav__link">
      psp3
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../developers/psp45_info/" title="psp45" class="md-nav__link">
      psp45
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../developers/psp5spinorbit_info/" title="psp5" class="md-nav__link">
      psp5
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../developers/psp6_info/" title="psp6" class="md-nav__link">
      psp6
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../developers/psp8_info/" title="psp8" class="md-nav__link">
      psp8
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../developers/codestats/" title="Code stats" class="md-nav__link">
      Code stats
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../developers/autoconf_examples/" title="Autoconf_examples" class="md-nav__link">
      Autoconf_examples
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7">
    
    <label class="md-nav__link" for="nav-7">
      About
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        About
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../about/release-notes/" title="Release Notes" class="md-nav__link">
      Release Notes
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../about/contributing/" title="Contributing" class="md-nav__link">
      Contributing
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../about/license/" title="License" class="md-nav__link">
      License
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#polarization-and-responses-to-finite-electric-fields-for-alas" title="Polarization, and responses to finite electric fields for AlAs." class="md-nav__link">
    Polarization, and responses to finite electric fields for AlAs.
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#1-ground-state-properties-of-alas-and-general-parameters" title="1 Ground-state properties of AlAs and general parameters" class="md-nav__link">
    1 Ground-state properties of AlAs and general parameters
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-berry-phase-calculation-of-polarization-in-zero-field" title="2 Berry phase calculation of polarization in zero field" class="md-nav__link">
    2 Berry phase calculation of polarization in zero field
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-finite-electric-field-calculations" title="3 Finite electric field calculations" class="md-nav__link">
    3 Finite electric field calculations
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              

                
                  <a href="https://github.com/abinit/abinit/edit/master/doc/tutorial/ffield.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="lesson-on-polarization-and-finite-electric-fields">Lesson on polarization and finite electric fields<a class="headerlink" href="#lesson-on-polarization-and-finite-electric-fields" title="Permanent link">&para;</a></h1>
<h2 id="polarization-and-responses-to-finite-electric-fields-for-alas">Polarization, and responses to finite electric fields for AlAs.<a class="headerlink" href="#polarization-and-responses-to-finite-electric-fields-for-alas" title="Permanent link">&para;</a></h2>
<p>This lesson aims at showing how to get the following physical properties, for an insulator:</p>
<ul>
<li>The polarization.</li>
<li>The Born effective charge (by finite differences of polarization)</li>
<li>The Born effective charge (by finite differences of forces)</li>
<li>The dielectric constant </li>
<li>The proper piezoelectric tensor (clamped and relaxed ions) </li>
</ul>
<p>The case of the linear responses (Born effective charge, dielectric constant,
piezoelectric tensor) is treated independently in other tutorials 
(<a href="../rf1">lesson Response-Function 1</a>, <a href="../elastic">lesson on Elastic properties</a>), 
using Density-Functional Perturbation Theory. 
You will learn here how to get these quantities using the finite
difference techniques within ABINIT. To that end, we will describe how to
compute the polarization, in the Berry phase formulation, and how to perform
finite electric field calculations.</p>
<p>This lesson should take about 1 hour and 30 minutes.</p>
<p>The basic theory for Berry phase computation of the polarization was proposed
by R. D. King-Smith and D. Vanderbilt in <a class="wikilink citation-wikilink" data-content="Theory of polarization of crystalline solids" data-placement="auto right" data-toggle="popover" data-trigger="hover focus" href="../../theory/bibliography#kingsmith1993">[Kingsmith1993]</a>.
The longer (excellent) paper D. Vanderbilt and R. D. King-Smith (<a class="wikilink citation-wikilink" data-content="Electric polarization as a bulk quantity and its relation to surface charge" data-placement="auto right" data-toggle="popover" data-trigger="hover focus" href="../../theory/bibliography#vanderbilt1993">[Vanderbilt1993]</a>)
clarifies many aspects of this theory (especially in view of application to AlAs, as in this tutorial). 
One might benefit also from a reading of the review article [[cite:Resta1994].</p>
<p>In order to gain the theoretical background needed to perform a calculation
with a finite electric field, you should consider reading the following papers:
<a class="wikilink citation-wikilink" data-content="First-Principles Approach to Insulators in Finite Electric Fields" data-placement="auto right" data-toggle="popover" data-trigger="hover focus" href="../../theory/bibliography#souza2002">[Souza2002]</a>, <a class="wikilink citation-wikilink" data-content="Berry-phase treatment of the homogeneous electric field perturbation in insulators" data-placement="auto right" data-toggle="popover" data-trigger="hover focus" href="../../theory/bibliography#nunes2001">[Nunes2001]</a> and 
M. Veithen <a href="https://www.abinit.org/sites/default/files/PhD-M.Veithen.pdf">PhD thesis</a>
Finally, the extension to the PAW formalism specifically in ABINIT is
discussed in <a class="wikilink citation-wikilink" data-content="ABINIT: First-principles approach to material and nanosystem properties" data-placement="auto right" data-toggle="popover" data-trigger="hover focus" href="../../theory/bibliography#gonze2009">[Gonze2009]</a> and <a class="wikilink citation-wikilink" data-content="Finite homogeneous electric fields in the projector augmented wave formalism: Applications to linear and nonlinear response" data-placement="auto right" data-toggle="popover" data-trigger="hover focus" href="../../theory/bibliography#zwanziger2012">[Zwanziger2012]</a>.</p>
<h2 id="1-ground-state-properties-of-alas-and-general-parameters">1 Ground-state properties of AlAs and general parameters<a class="headerlink" href="#1-ground-state-properties-of-alas-and-general-parameters" title="Permanent link">&para;</a></h2>
<p><em>Before beginning, you might consider working in a different subdirectory, as for the other lessons. 
Why not create &ldquo;Work-ffield&rdquo; in ~abinit/tests/tutorespfn/Input?</em></p>
<p>In this tutorial we will assume that the ground-state properties of AlAs have
been previously obtained, and that the corresponding convergence studies have been done. 
We will adopt the following set of generic parameters:</p>
<div class="codehilite"><pre><span></span>   acell               10.53
   ixc                 3
   ecut                2.8     (results with ecut = 5 are also reported
                               in the discussion)
   ecutsm              0.5
   dilatmx             1.05
   nband               4 (=number of occupied bands)
   ngkpt               6 6 6
   nshiftk             4
   shiftk   0.5 0.5 0.5
            0.5 0.0 0.0
            0.0 0.5 0.0
            0.0 0.0 0.5

   pseudopotentials    13al.pspnc
                       33as.pspnc
</pre></div>


<p>In principle, the <a class="wikilink codevar-wikilink" href="../../variables/basic#acell">acell</a> to be used should be the one corresponding to the
optimized structure at the <a class="wikilink codevar-wikilink" href="../../variables/basic#ecut">ecut</a>, and <a class="wikilink codevar-wikilink" href="../../variables/basic#ngkpt">ngkpt</a> combined with <a class="wikilink codevar-wikilink" href="../../variables/basic#nshiftk">nshiftk</a>
and <a class="wikilink codevar-wikilink" href="../../variables/basic#shiftk">shiftk</a>, chosen for the calculations. </p>
<p>Unfortunately, for the purpose of this tutorial, in order to limit the duration of the runs, 
we have to work at an unusually low cutoff of 2.8 Ha for which the optimized lattice constant is
equal to 7.45*0.707*2 Bohr=10.53 Bohr (instead of the converged value of 10.64
Bohr). For comparison, results with <a class="wikilink codevar-wikilink" href="../../variables/basic#ecut">ecut</a>=5 are also reported and, in that
case, were obtained at the optimized lattice constant of 10.64 bohr. For those
who would like to try later, convergence tests and structural optimizations
can be done using the file <a class="wikilink abifile-wikilink" data-content="Structural optimisation" data-placement="auto right" data-toggle="popover" data-trigger="hover focus" href="../../tests/tutorespfn/Input/tnlo_1.in" target="_blank">tests/tutorespfn/Input/tnlo_1.in</a>. Before going
further, you might refresh your memory concerning the other variables:
<a class="wikilink codevar-wikilink" href="../../variables/basic#ixc">ixc</a>, <a class="wikilink codevar-wikilink" href="../../variables/rlx#ecutsm">ecutsm</a>, <a class="wikilink codevar-wikilink" href="../../variables/rlx#dilatmx">dilatmx</a>.</p>
<h2 id="2-berry-phase-calculation-of-polarization-in-zero-field">2 Berry phase calculation of polarization in zero field<a class="headerlink" href="#2-berry-phase-calculation-of-polarization-in-zero-field" title="Permanent link">&para;</a></h2>
<p>In this section, you will learn how to perform a Berry phase calculation of
the polarization. As a practical problem we will try to compute the Born
effective charges from finite difference of the polarization (under finite
atomic displacements), for AlAs.</p>
<p>You can now copy the file <a class="wikilink abifile-wikilink" data-content="Finite difference calculation of the Born effective charges of AlAs" data-placement="auto right" data-toggle="popover" data-trigger="hover focus" href="../../tests/tutorespfn/Input/tffield_1.in" target="_blank">tests/tutorespfn/Input/tffield_1.in</a> and
<a class="wikilink abifile-wikilink" href="../../tests/tutorespfn/Input/tffield_x.files" target="_blank">tests/tutorespfn/Input/tffield_x.files</a> in Work-ffield, and modify the
latter as usual (for example, edit it so that the various file names it
contains refer to tffield_1 rather than tffield_x).</p>
<div class="text-center"><div class="btn-group-vertical">
<button type="button" id="uuid-cf09975d-68ce-4328-b0ce-cec5f7ecdd85" class="btn btn-default btn-labeled">
  <span class="btn-label"><i class="fa fa-window-restore" aria-hidden="true"></i></span>View tests/tutorespfn/Input/tffield_x.files
</button>
<button type="button" id="uuid-90750b2c-844f-4474-ac7f-5b14cf164d18" class="btn btn-default btn-labeled">
  <span class="btn-label"><i class="fa fa-window-restore" aria-hidden="true"></i></span>View tests/tutorespfn/Input/tffield_1.in
</button>
</div></div>

<div id="uuid-66904d75-2341-4742-b162-e27a0dab01f4" class="my_dialog" title="tests/tutorespfn/Input/tffield_x.files" hidden><div><pre class="small-text">
../tffield_1.in
tffield_x.out
tffield_xi
tffield_xo
tffield_x
../../../Psps_for_tests/13al.pspnc
../../../Psps_for_tests/33as.pspnc

</pre>
</div></div>

<script> $(function() { abidocs_jqueryui_dialog("#uuid-66904d75-2341-4742-b162-e27a0dab01f4", "#uuid-cf09975d-68ce-4328-b0ce-cec5f7ecdd85") }); </script>

<div id="uuid-1f0380e8-a879-4ee9-aeff-3b96e8a819a2" class="my_dialog" title="tests/tutorespfn/Input/tffield_1.in" hidden><div><div class="codehilite small-text"><pre><span></span><span class="c1"># Finite difference calculation of the Born effective charges of AlAs</span>
<span class="c1"># (M. Veithen, 29.4.2005)</span>
<span class="c1">#</span>

<span class="c1">#Definition of the different datasets </span>
<span class="c1">#************************************</span>

ndtset <span class="m">3</span>
jdtset <span class="m">1</span> <span class="m">2</span> <span class="m">3</span>

            xcart1     <span class="m">0</span>.0000000000E+00  <span class="m">0</span>.0000000000E+00  <span class="m">0</span>.0000000000E+00
                       <span class="m">2</span>.6325000000E+00  <span class="m">2</span>.6325000000E+00  <span class="m">2</span>.6325000000E+00

            xcart2     <span class="m">1</span>.0000000000E-02  <span class="m">0</span>.0000000000E+00  <span class="m">0</span>.0000000000E+00
                       <span class="m">2</span>.6325000000E+00  <span class="m">2</span>.6325000000E+00  <span class="m">2</span>.6325000000E+00

            xcart3    -1.0000000000E-02  <span class="m">0</span>.0000000000E+00  <span class="m">0</span>.0000000000E+00
                       <span class="m">2</span>.6325000000E+00  <span class="m">2</span>.6325000000E+00  <span class="m">2</span>.6325000000E+00


<span class="c1">#Definition of the elementary cell</span>
<span class="c1">#*********************************</span>
   acell <span class="m">3</span>*10.53
   rprim <span class="m">0</span>.0 <span class="m">0</span>.5 <span class="m">0</span>.5
         <span class="m">0</span>.5 <span class="m">0</span>.0 <span class="m">0</span>.5
         <span class="m">0</span>.5 <span class="m">0</span>.5 <span class="m">0</span>.0

<span class="c1">#Definition of the atoms</span>
<span class="c1">#***********************</span>
   nband <span class="m">4</span>
   natom <span class="m">2</span>
   ntypat <span class="m">2</span>
   znucl <span class="m">13</span> <span class="m">33</span>
   typat <span class="m">1</span> <span class="m">2</span>
   ixc <span class="m">3</span>

<span class="c1">#Definition of the SCF procedure</span>
<span class="c1">#*******************************</span>
   nstep <span class="m">100</span>


<span class="c1">#Definition of the plane wave basis set</span>
<span class="c1">#**************************************</span>
   ecut  <span class="m">2</span>.8
   ecutsm <span class="m">0</span>.5
   dilatmx <span class="m">1</span>.05
   ngkpt <span class="m">6</span> <span class="m">6</span> <span class="m">6</span>
   nshiftk <span class="m">4</span>
   shiftk <span class="m">0</span>.5 <span class="m">0</span>.5 <span class="m">0</span>.5
          <span class="m">0</span>.5 <span class="m">0</span>.0 <span class="m">0</span>.0
          <span class="m">0</span>.0 <span class="m">0</span>.5 <span class="m">0</span>.0
          <span class="m">0</span>.0 <span class="m">0</span>.0 <span class="m">0</span>.5
   toldfe <span class="m">1</span>.0d-12

<span class="c1"># Berry phase calculation of the polarization</span>
<span class="c1">#********************************************</span>
   berryopt -1
   rfdir <span class="m">1</span> <span class="m">1</span> <span class="m">1</span>



<span class="c1">## After modifying the following section, one might need to regenerate the pickle database with runtests.py -r</span>
<span class="c1">#%%&lt;BEGIN TEST_INFO&gt;</span>
<span class="c1">#%% [setup]</span>
<span class="c1">#%% executable = abinit</span>
<span class="c1">#%% [files]</span>
<span class="c1">#%% files_to_test = </span>
<span class="c1">#%%   tffield_1.out, tolnlines=  1, tolabs=  1.100e-08, tolrel=  3.000e-04</span>
<span class="c1">#%% psp_files =  13al.pspnc, 33as.pspnc</span>
<span class="c1">#%% [paral_info]</span>
<span class="c1">#%% max_nprocs = 2</span>
<span class="c1">#%% [extra_info]</span>
<span class="c1">#%% authors = M. Veithen</span>
<span class="c1">#%% keywords = NC, DFPT</span>
<span class="c1">#%% description = </span>
<span class="c1">#%%  Finite difference calculation of the Born effective charges of AlAs</span>
<span class="c1">#%%&lt;END TEST_INFO&gt;</span>
</pre></div>
</div></div>

<script> $(function() { abidocs_jqueryui_dialog("#uuid-1f0380e8-a879-4ee9-aeff-3b96e8a819a2", "#uuid-90750b2c-844f-4474-ac7f-5b14cf164d18") }); </script>

<p>Note that two pseudopotentials are mentioned in this &ldquo;files&rdquo; file: one for the
Aluminum atom, and one for the Arsenic atom. The first to be mentioned, for
Al, will define the first type of atom. The second to be mentioned, for As,
will define the second type of atom. It might the first time that you
encounter this situation (more than one type of atoms) in the tutorials, at
variance with the four &ldquo;basic&rdquo; lessons.</p>
<p>Because of the use of two types of atoms, have also a look at the following
input variables present, in the &ldquo;input&rdquo; file:</p>
<ul>
<li><a class="wikilink codevar-wikilink" href="../../variables/basic#ntypat">ntypat</a> </li>
<li><a class="wikilink codevar-wikilink" href="../../variables/basic#typat">typat</a> </li>
</ul>
<p>You can start the calculation. It should take 90 seconds on a PC 3GHz. Then,
examine the tffield_1.in file. It is made of three datasets corresponding to
the reference optimized structure (tau=0) and to structure with the Al atom
displaced from 0.01 bohr right and left (referred to as tau = +0.01 and tau =
-0.01). This is typically the amplitude of atomic displacement to be
considered in this kind of computations. Notice also that the displacements
are given using <a class="wikilink codevar-wikilink" href="../../variables/basic#xcart">xcart</a>, that is, explicitly in Cartesian directions, rather
than the primitive cell axes (using <a class="wikilink codevar-wikilink" href="../../variables/basic#xred">xred</a>). This makes the correspondence
with the polarization output in Cartesian directions much simpler to understand.</p>
<p>There are two implementations of the Berry phase within ABINIT. One
corresponds to positive values of <a class="wikilink codevar-wikilink" href="../../variables/ffield#berryopt">berryopt</a> and was implemented by Na Sai.
The other one corresponds to negative values of <a class="wikilink codevar-wikilink" href="../../variables/ffield#berryopt">berryopt</a> was implemented
by Marek Veithen. Both are suitable to compute the polarization. Here we will
focus on the implementation of Marek Veithen for two reasons. First, the
results are directly provided in Cartesian coordinates at the end of the run
(while the implementation of Na Sai reports them in reduced coordinates).
Second the implementation of Marek Veithen is the one to be used for the
finite electric field calculation as described in the next Section. Finally,
note also that Veithen&rsquo;s implementation works with <a class="wikilink codevar-wikilink" href="../../variables/basic#kptopt">kptopt</a> = 1 or 2 while
Na Sai implementation is restricted to <a class="wikilink codevar-wikilink" href="../../variables/basic#kptopt">kptopt</a> = 2, which is less convenient.</p>
<p>The file is the one of a usual self-consistent calculation. On top of the
usual variables, for the Berry phase calculation we simply need 
to define <a class="wikilink codevar-wikilink" href="../../variables/ffield#berryopt">berryopt</a> and <a class="wikilink codevar-wikilink" href="../../variables/dfpt#rfdir">rfdir</a>:</p>
<div class="codehilite"><pre><span></span>        berryopt      -1
        rfdir          1 1 1
</pre></div>


<p>Make the run, then open the output file and look for the occurrence &ldquo;Berry&rdquo;.
The output reports values of the Berry phase for individual k-point strings.</p>
<div class="codehilite"><pre><span></span> Computing the polarization (Berry phase) for reciprocal vector:
  0.16667  0.00000  0.00000 (in reduced coordinates)
 -0.01583  0.01583  0.01583 (in cartesian coordinates - atomic units)
 Number of strings:   144
 Number of k points in string:    6

 Summary of the results
 Electronic Berry phase     2.025856545E-03
            Ionic phase    -7.500000000E-01
            Total phase    -7.479741435E-01
    Remapping in [-1,1]    -7.479741435E-01

           Polarization    -1.557862799E-02 (a.u. of charge)/bohr^2
           Polarization    -8.913274846E-01 C/m^2
</pre></div>


<p>The &ldquo;Remapping in [-1,1]&rdquo; is there to avoid the quantum of polarization. As
discussed in <a class="wikilink citation-wikilink" data-content="First-principles study of the ferroelectric Aurivillius phase Bi2WO6" data-placement="auto right" data-toggle="popover" data-trigger="hover focus" href="../../theory/bibliography#djani2012">[Djani2012]</a>, the indeterminacy of the quantum phase, directly
related to the quantum of polarization, can lead to spurious effects (see Fig.
2 of the above-mentioned paper). By remapping on the [-1,1] interval, any
indeterminacy is removed. However, removing such a quantum of polarization
between two calculations might give the false impression that one is on the
same polarization branch in the two calculations, while actually the branch is
made different by this remapping. Cross-checking the polarization results by
computing the Born effective charge, further multiplied by the displacements
between the two geometries is an excellent way to estimate the amplitude of the polarization.</p>
<p>Other subtleties of Berry phases, explained in <a class="wikilink citation-wikilink" data-content="Electric polarization as a bulk quantity and its relation to surface charge" data-placement="auto right" data-toggle="popover" data-trigger="hover focus" href="../../theory/bibliography#vanderbilt1993">[Vanderbilt1993]</a> also apply. 
First, note that neither the electronic Berry phase nor the ionic phase vanish in this highly
symmetric case, contrary to intuition. Even though AlAs does not have
inversion symmetry, it does have tetrahedral symmetry, which would be enough
to make an ordinary vector vanish. But a lattice-valued vector does not have
to vanish: the lattice just has to transform into itself under the tetrahedral
point group. The ionic phase corresponds actually to a lattice-valued vector
(-&frac34; -&frac34; -&frac34;). Concerning the electronic phase, it does not exactly vanish,
unless the sampling of k points becomes continuous. If you go further in the
file you will find the final results in cartesian coordinates. You can collect
them for the different values of tau.</p>
<p>tau = 0</p>
<div class="codehilite"><pre><span></span> Polarization in cartesian coordinates (a.u.):
 (the sum of the electronic and ionic Berry phase has been folded into [-1, 1])
     Electronic berry phase:        0.730822547E-04   0.730822547E-04   0.730822547E-04
     Ionic:                        -0.270560574E-01  -0.270560574E-01  -0.270560574E-01  
     Total:                        -0.269829752E-01  -0.269829752E-01  -0.269829752E-01

 Polarization in cartesian coordinates (C/m^2):
 (the sum of the electronic and ionic Berry phase has been folded into [-1, 1])
     Electronic berry phase:        0.418138377E-02   0.418138377E-02   0.418138377E-02
     Ionic:                        -0.154800587E+01  -0.154800587E+01  -0.154800587E+01  
     Total:                        -0.154382449E+01  -0.154382449E+01  -0.154382449E+01
</pre></div>


<p>tau = +0.01</p>
<div class="codehilite"><pre><span></span> Polarization in cartesian coordinates (a.u.):
 (the sum of the electronic and ionic Berry phase has been folded into [-1, 1])
     Electronic berry phase:        0.410030549E-04   0.730924693E-04   0.730924693E-04
     Ionic:                        -0.269532804E-01  -0.270560574E-01  -0.270560574E-01  
     Total:                        -0.269122773E-01  -0.269829650E-01  -0.269829650E-01

 Polarization in cartesian coordinates (C/m^2):
 (the sum of the electronic and ionic Berry phase has been folded into [-1, 1])
     Electronic berry phase:        0.234598001E-02   0.418196820E-02   0.418196820E-02
     Ionic:                        -0.154212551E+01  -0.154800587E+01  -0.154800587E+01  
     Total:                        -0.153977953E+01  -0.154382391E+01  -0.154382391E+01
</pre></div>


<p>tau = -0.01</p>
<div class="codehilite"><pre><span></span> Polarization in cartesian coordinates (a.u.):
 (the sum of the electronic and ionic Berry phase has been folded into [-1, 1])
     Electronic berry phase:        0.105181874E-03   0.730924694E-04   0.730924694E-04
     Ionic:                        -0.271588345E-01  -0.270560574E-01  -0.270560574E-01  
     Total:                        -0.270536526E-01  -0.269829650E-01  -0.269829650E-01

 Polarization in cartesian coordinates (C/m^2):
 (the sum of the electronic and ionic Berry phase has been folded into [-1, 1])
     Electronic berry phase:        0.601795583E-02   0.418196820E-02   0.418196820E-02
     Ionic:                        -0.155388624E+01  -0.154800587E+01  -0.154800587E+01  
     Total:                        -0.154786828E+01  -0.154382391E+01  -0.154382391E+01
</pre></div>


<p>From the previous data, we can extract the Born effective charge of Al. Values
to be used are those in a.u., in order to find the charge in electron unit. It
corresponds to (the volume of the primitive unit cell must be specified in Bohr too):</p>
<div class="codehilite"><pre><span></span>        Z* = \Omega_0  (P[tau=+0.01] - P[tau=-0.01]) / (2*tau)
           =  291.89   (-0.269122773E-01 - -0.270536526E-01) / 0.02
           = 2.06
</pre></div>


<p>For comparison, the calculation using Density-Functional Perturbation Theory
(DFPT) can be done by using the file ~abinit/tests/tutorespfn/Input/tffield_2.in. </p>
<div class="text-center"><button type="button" id="uuid-0dc25049-f496-4556-bae2-af1e63b3597a" class="btn btn-default btn-labeled">
  <span class="btn-label"><i class="fa fa-window-restore" aria-hidden="true"></i></span>View tests/tutorespfn/Input/tffield_2.in
</button></div>

<div id="uuid-286b505d-90a7-484e-b718-400399bf5f64" class="my_dialog" title="tests/tutorespfn/Input/tffield_2.in" hidden><div><div class="codehilite small-text"><pre><span></span><span class="c1"># Linear response calculation for AlAs</span>
<span class="c1"># Perturbation: atomic displacements &amp; strains</span>
<span class="c1"># Finite difference calculation of the ddk</span>
<span class="c1"># (M. Veithen, 28.4.2005)</span>

<span class="c1">#Definition of the primitive cell</span>
<span class="c1">#********************************</span>
   acell       <span class="m">3</span>*10.53
   rprim       <span class="m">0</span>.0 <span class="m">0</span>.5 <span class="m">0</span>.5
               <span class="m">0</span>.5 <span class="m">0</span>.0 <span class="m">0</span>.5
               <span class="m">0</span>.5 <span class="m">0</span>.5 <span class="m">0</span>.0

<span class="c1">#Definition atomic positions and types</span>
<span class="c1">#*************************************</span>
   natom       <span class="m">2</span>
   ntypat      <span class="m">2</span>
   znucl       <span class="m">13</span> <span class="m">33</span>
   typat       <span class="m">1</span> <span class="m">2</span>
   xred        <span class="m">0</span>    <span class="m">0</span>    <span class="m">0</span>
               <span class="m">0</span>.25 <span class="m">0</span>.25 <span class="m">0</span>.25
   ixc         <span class="m">3</span>

<span class="c1">#Parameters of the SCF cycles</span>
<span class="c1">#****************************</span>
   nstep       <span class="m">100</span>


<span class="c1">#Pland wave basis and k-point grid</span>
<span class="c1">#*********************************</span>
   ecut        <span class="m">2</span>.8
   ecutsm      <span class="m">0</span>.5
   dilatmx     <span class="m">1</span>.05
   ngkpt       <span class="m">6</span> <span class="m">6</span> <span class="m">6</span>
   nshiftk     <span class="m">4</span>
   shiftk      <span class="m">0</span>.5 <span class="m">0</span>.5 <span class="m">0</span>.5
               <span class="m">0</span>.5 <span class="m">0</span>.0 <span class="m">0</span>.0
               <span class="m">0</span>.0 <span class="m">0</span>.5 <span class="m">0</span>.0
               <span class="m">0</span>.0 <span class="m">0</span>.0 <span class="m">0</span>.5


ndtset <span class="m">3</span>    

<span class="c1">#DATASET1 : scf calculation: GS WF in the BZ</span>
<span class="c1">#********************************************</span>
   prtden1    <span class="m">1</span>
   kptopt1    <span class="m">1</span>
   toldfe1    <span class="m">1</span>.0d-12

<span class="c1">#DATASET2 : non scf calculation: GS WF in the whole BZ</span>
<span class="c1">#*****************************************************</span>
   getden2    <span class="m">1</span>
   kptopt2    <span class="m">2</span>
     iscf2   -2
   getwfk2    <span class="m">1</span>
   tolwfr2    <span class="m">1</span>.0d-22
    nband2    <span class="m">4</span>
 berryopt2   -2
    rfdir2    <span class="m">1</span> <span class="m">1</span> <span class="m">1</span>

<span class="c1">#DATASET3 : linear response to atomic displacements and strains</span>
<span class="c1">#**************************************************************</span>
   getwfk3    <span class="m">2</span>
   getddk3    <span class="m">2</span>
    rfdir3    <span class="m">1</span> <span class="m">1</span> <span class="m">1</span>
   rfstrs3    <span class="m">3</span>
   rfphon3    <span class="m">1</span>
  rfatpol3    <span class="m">1</span> <span class="m">2</span>
   toldfe3    <span class="m">1</span>.0d-12
    nband3    <span class="m">4</span>
   kptopt3    <span class="m">2</span>



<span class="c1">## After modifying the following section, one might need to regenerate the pickle database with runtests.py -r</span>
<span class="c1">#%%&lt;BEGIN TEST_INFO&gt;</span>
<span class="c1">#%% [setup]</span>
<span class="c1">#%% executable = abinit</span>
<span class="c1">#%% test_chain = tffield_2.in, tffield_3.in</span>
<span class="c1">#%% [files]</span>
<span class="c1">#%% files_to_test = </span>
<span class="c1">#%%   tffield_2.out, tolnlines=  2, tolabs=  5.000e-07, tolrel=  3.000e-04, fld_options=-medium</span>
<span class="c1">#%% psp_files =  13al.pspnc, 33as.pspnc</span>
<span class="c1">#%% [paral_info]</span>
<span class="c1">#%% max_nprocs = 2</span>
<span class="c1">#%% [extra_info]</span>
<span class="c1">#%% authors = M. Veithen</span>
<span class="c1">#%% keywords = NC, DFPT</span>
<span class="c1">#%% description = </span>
<span class="c1">#%%   Linear response calculation for AlAs</span>
<span class="c1">#%%   Perturbation: atomic displacements &amp; strains</span>
<span class="c1">#%%   Finite difference calculation of the ddk</span>
<span class="c1">#%%&lt;END TEST_INFO&gt;</span>
</pre></div>
</div></div>

<script> $(function() { abidocs_jqueryui_dialog("#uuid-286b505d-90a7-484e-b718-400399bf5f64", "#uuid-0dc25049-f496-4556-bae2-af1e63b3597a") }); </script>

<p>Actually, the file tffield_2.in
not only leads to the computation of the Born effective charges, but also the
computation of the piezoelectric constants (see later).</p>
<p>You can review how to use DFPT thanks to the <a href="../rf1">lesson Response-function 1</a> and <a href="../rf2">lesson Response-function 2</a>
tutorials. For now, go ahead and run the input file, and have a look at the
output file, to identify the place where the Born effective charge is written
(search for the phrase &ldquo;Effective charges&rdquo; in the output file). The value we
get from DFPT is 2.06, in agreement with the above-mentioned value of 2.06.
This level of agreement is fortuitous for unconverged calculations, though
both methods (finite-difference and DFPT) will tend to the same value for
better converged calculations.</p>
<p>The DDB generated by ~abinit/tests/tutorespfn/Input/tffield_2.in can be fed in
anaddb, thanks to the ~abinit/tests/tutorespfn/Input/tffield_3.in input file
and the tffield_3.files file. </p>
<div class="text-center"><div class="btn-group-vertical">
<button type="button" id="uuid-9ee1f559-ae6c-43ac-9b5f-3cfd495692a9" class="btn btn-default btn-labeled">
  <span class="btn-label"><i class="fa fa-window-restore" aria-hidden="true"></i></span>View tests/tutorespfn/Input/tffield_3.files
</button>
<button type="button" id="uuid-fa7b5ae5-ac76-4aa5-8e44-cf159f5c37bf" class="btn btn-default btn-labeled">
  <span class="btn-label"><i class="fa fa-window-restore" aria-hidden="true"></i></span>View tests/tutorespfn/Input/tffield_3.in
</button>
</div></div>

<div id="uuid-c82d9c42-0f2a-4e99-b696-1705057597ce" class="my_dialog" title="tests/tutorespfn/Input/tffield_3.files" hidden><div><pre class="small-text">
tffield_3.in
tffield_3.out
tffield_2o_DS3_DDB
tffield_3_band2eps
tffield_dummy1
tffield_dummy2
tffield_dummy3

</pre>
</div></div>

<script> $(function() { abidocs_jqueryui_dialog("#uuid-c82d9c42-0f2a-4e99-b696-1705057597ce", "#uuid-9ee1f559-ae6c-43ac-9b5f-3cfd495692a9") }); </script>

<div id="uuid-5b7e3d97-d976-4e5e-abb7-fd405ebf60fc" class="my_dialog" title="tests/tutorespfn/Input/tffield_3.in" hidden><div><div class="codehilite small-text"><pre><span></span><span class="c1"># General informations</span>
<span class="c1">#**********************</span>
   rfmeth  <span class="m">1</span>
   chneut  <span class="m">2</span>

<span class="c1"># Flags</span>
<span class="c1">#*******</span>
   elaflag  <span class="m">3</span>
 piezoflag  <span class="m">3</span>
 instrflag  <span class="m">1</span>


<span class="c1">## After modifying the following section, one might need to regenerate the pickle database with runtests.py -r</span>
<span class="c1">#%%&lt;BEGIN TEST_INFO&gt;</span>
<span class="c1">#%% [setup]</span>
<span class="c1">#%% executable = anaddb</span>
<span class="c1">#%% test_chain = tffield_2.in, tffield_3.in</span>
<span class="c1">#%% input_ddb = tffield_2o_DS3_DDB</span>
<span class="c1">#%% [files]</span>
<span class="c1">#%% files_to_test = </span>
<span class="c1">#%%   tffield_3.out, tolnlines=  0, tolabs=  0.000e+00, tolrel=  0.000e+00, fld_options = -easy</span>
<span class="c1">#%% [paral_info]</span>
<span class="c1">#%% max_nprocs = 4</span>
<span class="c1">#%% [extra_info]</span>
<span class="c1">#%% authors = M. Veithen, P. Ghosez</span>
<span class="c1">#%% keywords = </span>
<span class="c1">#%% description = Anaddb input file.</span>
<span class="c1">#%%&lt;END TEST_INFO&gt;</span>
</pre></div>
</div></div>

<script> $(function() { abidocs_jqueryui_dialog("#uuid-5b7e3d97-d976-4e5e-abb7-fd405ebf60fc", "#uuid-fa7b5ae5-ac76-4aa5-8e44-cf159f5c37bf") }); </script>

<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Note that tffield_3.files is expecting the DDB
to be named tffield_2o_DS3_DDB, so either adjust tffield_x.files before
running tffield_2.in to match this, or else change the name of the DDB file
after generation. </p>
</div>
<p>In any case, the DFPT calculation gives for the
piezoelectric constants (as well as the elastic constants), as found in
tffield_3.out, the following:</p>
<div class="codehilite"><pre><span></span>  Proper piezoelectric constants (clamped ion) (unit:c/m^2)
 ...
     -0.64879283      0.00000000      0.00000000
 ...
  Proper piezoelectric constants (relaxed ion) (unit:c/m^2)
 ...
      0.04575010      0.00000000      0.00000000
</pre></div>


<div class="text-center"><button type="button" id="uuid-241eaf09-62f0-4ac1-bb0a-8f857beaafa5" class="btn btn-default btn-labeled">
  <span class="btn-label"><i class="fa fa-window-restore" aria-hidden="true"></i></span>View tests/tutorespfn/Refs/tffield_3.out
</button></div>

<div id="uuid-8337b311-c87f-4f00-8769-6ef841c71ef0" class="my_dialog" title="tests/tutorespfn/Refs/tffield_3.out" hidden><div><pre class="small-text">

.Version 8.0.3 of ANADDB 
.(MPI version, prepared for a x86_64_linux_gnu5.3 computer) 

.Copyright (C) 1998-2018 ABINIT group . 
 ANADDB comes with ABSOLUTELY NO WARRANTY.
 It is free software, and you are welcome to redistribute it
 under certain conditions (GNU General Public License,
 see ~abinit/COPYING or http://www.gnu.org/copyleft/gpl.txt).

 ABINIT is a project of the Universite Catholique de Louvain,
 Corning Inc. and other collaborators, see ~abinit/doc/developers/contributors.txt .
 Please read ~abinit/doc/users/acknowledgments.html for suggested
 acknowledgments of the ABINIT effort.
 For more information, see https://www.abinit.org .

.Starting date : Mon  4 Apr 2016.
- ( at 09h52 )


================================================================================

 -outvars_anaddb: echo values of input variables ----------------------

 Flags :
     elaflag         3
   instrflag         1
   piezoflag         3
 Miscellaneous information :
         asr         1
      chneut         2

================================================================================

 read the DDB information and perform some checks

 Real(R)+Recip(G) space primitive vectors, cartesian coordinates (Bohr,Bohr^-1):
 R(1)=  0.0000000  5.2650000  5.2650000  G(1)= -0.0949668  0.0949668  0.0949668
 R(2)=  5.2650000  0.0000000  5.2650000  G(2)=  0.0949668 -0.0949668  0.0949668
 R(3)=  5.2650000  5.2650000  0.0000000  G(3)=  0.0949668  0.0949668 -0.0949668
 Unit cell volume ucvol=  2.9189397E+02 bohr^3
 Angles (23,13,12)=  6.00000000E+01  6.00000000E+01  6.00000000E+01 degrees
 Now the whole DDB is in central memory

================================================================================

 Calculation of the internal-strain  tensor


 Force-response internal strain tensor(Unit:Hartree/bohr)

 Atom dir   strainxx    strainyy    strainzz    strainyz    strainxz    strainxy
  1  x     0.0000000   0.0000000   0.0000000   0.1759596   0.0000000   0.0000000
  1  y     0.0000000   0.0000000   0.0000000   0.0000000   0.1759596  -0.0000000
  1  z    -0.0000000  -0.0000000  -0.0000000   0.0000000  -0.0000000   0.1759596
  2  x    -0.0000000  -0.0000000  -0.0000000  -0.1759596  -0.0000000  -0.0000000
  2  y    -0.0000000  -0.0000000  -0.0000000  -0.0000000  -0.1759596   0.0000000
  2  z     0.0000000   0.0000000   0.0000000  -0.0000000   0.0000000  -0.1759596

 Displacement-response internal strain tensor (Unit:Bohr)

 Atom dir   strainxx    strainyy    strainzz    strainyz    strainxz    strainxy
  1  x     0.0000000   0.0000000   0.0000000   0.8586685   0.0000000   0.0000000
  1  y     0.0000000   0.0000000   0.0000000   0.0000000   0.8586685  -0.0000000
  1  z    -0.0000000  -0.0000000  -0.0000000   0.0000000  -0.0000000   0.8586685
  2  x    -0.0000000  -0.0000000  -0.0000000  -0.8586685  -0.0000000  -0.0000000
  2  y    -0.0000000  -0.0000000  -0.0000000  -0.0000000  -0.8586685   0.0000000
  2  z     0.0000000   0.0000000   0.0000000  -0.0000000   0.0000000  -0.8586685

================================================================================

 Calculation of the elastic and compliances tensor (Voigt notation)


 Elastic Tensor (clamped ion) (unit:10^2GP):

   1.2241902   0.6348587   0.6348587  -0.0000000  -0.0000000  -0.0000000
   0.6348587   1.2241902   0.6348587  -0.0000000  -0.0000000  -0.0000000
   0.6348587   0.6348587   1.2241902  -0.0000000  -0.0000000  -0.0000000
  -0.0000000  -0.0000000  -0.0000000   0.8774857   0.0000000   0.0000000
   0.0000000   0.0000000   0.0000000   0.0000000   0.8774857  -0.0000000
   0.0000000   0.0000000   0.0000000   0.0000000  -0.0000000   0.8774857

 Elastic Tensor (relaxed ion) (unit:10^2GP):
  (at fixed electric field boundary condition)

   1.2241902   0.6348587   0.6348587  -0.0000000  -0.0000000  -0.0000000
   0.6348587   1.2241902   0.6348587  -0.0000000  -0.0000000  -0.0000000
   0.6348587   0.6348587   1.2241902  -0.0000000  -0.0000000  -0.0000000
  -0.0000000  -0.0000000  -0.0000000   0.5729059   0.0000000  -0.0000000
   0.0000000  -0.0000000  -0.0000000   0.0000000   0.5729059  -0.0000000
   0.0000000   0.0000000   0.0000000  -0.0000000  -0.0000000   0.5729059

 Compliance Tensor (clamped ion) (unit: 10^-2GP^-1):

   1.2648844  -0.4319536  -0.4319536   0.0000000   0.0000000   0.0000000
  -0.4319536   1.2648844  -0.4319536  -0.0000000   0.0000000   0.0000000
  -0.4319536  -0.4319536   1.2648844  -0.0000000   0.0000000   0.0000000
  -0.0000000   0.0000000   0.0000000   1.1396197  -0.0000000  -0.0000000
  -0.0000000   0.0000000   0.0000000  -0.0000000   1.1396197   0.0000000
  -0.0000000  -0.0000000   0.0000000  -0.0000000   0.0000000   1.1396197

 Compliance Tensor (relaxed ion)  (unit: 10^-2GP^-1):
  (at fixed electric field boundary condition)

   1.2648844  -0.4319536  -0.4319536   0.0000000   0.0000000   0.0000000
  -0.4319536   1.2648844  -0.4319536  -0.0000000   0.0000000   0.0000000
  -0.4319536  -0.4319536   1.2648844  -0.0000000   0.0000000   0.0000000
  -0.0000000   0.0000000   0.0000000   1.7454872  -0.0000000   0.0000000
  -0.0000000   0.0000000   0.0000000  -0.0000000   1.7454872   0.0000000
  -0.0000000  -0.0000000   0.0000000   0.0000000   0.0000000   1.7454873

================================================================================

 Calculation of the tensor related to piezoelectric effetc
  (Elastic indices in Voigt notation)


 Proper piezoelectric constants (clamped ion) (unit:c/m^2)

      0.00000000      0.00000000      0.00000000
      0.00000000      0.00000000      0.00000000
     -0.00000000     -0.00000000      0.00000000
     -0.64879283      0.00000000      0.00000000
      0.00000000     -0.64879282      0.00000000
      0.00000000      0.00000000     -0.64879282

 ddb_piezo : WARNING -
  Acoustic sum rule violation met : the eigenvalues of accoustic mode
  are too large at Gamma point
  Increase cutoff energy or k-points sampling.
  The three eigenvalues are:    1.305542E-06    1.581522E-18    1.305542E-06

 Proper piezoelectric constants (relaxed ion) (unit:c/m^2)

      0.00000000      0.00000000     -0.00000000
      0.00000000      0.00000000     -0.00000000
      0.00000000      0.00000000     -0.00000000
      0.04575010      0.00000000      0.00000000
      0.00000000      0.04575010     -0.00000000
      0.00000000     -0.00000000      0.04575011
-
- Proc.   0 individual time (sec): cpu=          0.1  wall=          0.0

================================================================================

+Total cpu time      0.051  and wall time      0.034 sec

 anaddb : the run completed succesfully.

</pre>
</div></div>

<script> $(function() { abidocs_jqueryui_dialog("#uuid-8337b311-c87f-4f00-8769-6ef841c71ef0", "#uuid-241eaf09-62f0-4ac1-bb0a-8f857beaafa5") }); </script>

<p>Restarting case ffield_2 and ffield_3 with <a class="wikilink codevar-wikilink" href="../../variables/basic#ecut">ecut</a>=5 
(three minutes on a PC 3 GHz), one gets the following values</p>
<div class="codehilite"><pre><span></span>  Proper piezoelectric constants (clamped ion) (unit:c/m^2)
 ...
     -0.68377667      0.00000000      0.00000000
 ...
  Proper piezoelectric constants (relaxed ion) (unit:c/m^2)
 ...
      0.03384772      0.00000000      0.00000000
</pre></div>


<p>The latter value, where the ionic relaxation largely suppresses the electronic
piezoelectricity, will be much more difficult to converge than the clamped ion result.</p>
<p>Using the Berry phase approach it is also possible to compute the
piezoelectric constant from finite difference of polarization with respect to strains. 
This can be done considering clamped ions or relaxed ions
configurations. </p>
<p>For this purpose, have a look at the files
~abinit/tests/tutorespfn/Input/tffield_4.in (clamped ions) and
~abinit/tests/tutorespfn/Input/tffield_5.in (relaxed ions). </p>
<div class="text-center"><div class="btn-group-vertical">
<button type="button" id="uuid-452fdb90-6171-410a-bf2f-adf555187f3c" class="btn btn-default btn-labeled">
  <span class="btn-label"><i class="fa fa-window-restore" aria-hidden="true"></i></span>View tests/tutorespfn/Input/tffield_4.in
</button>
<button type="button" id="uuid-4d0992ac-5441-486a-843c-390f530e92a2" class="btn btn-default btn-labeled">
  <span class="btn-label"><i class="fa fa-window-restore" aria-hidden="true"></i></span>View tests/tutorespfn/Input/tffield_5.in
</button>
</div></div>

<div id="uuid-a4606b4a-0070-4f97-a03e-6a8159fdeb97" class="my_dialog" title="tests/tutorespfn/Input/tffield_4.in" hidden><div><div class="codehilite small-text"><pre><span></span><span class="c1"># Finite difference calculation of the clamped-ion</span>
<span class="c1"># piezoelectric constants of AlAs</span>
<span class="c1"># (M. Veithen, 3.5.2005)</span>

ndtset <span class="m">3</span>

<span class="c1"># strain: eta_4 = 0.00</span>
acell1     <span class="m">3</span>*7.44856
rprim1        <span class="m">0</span>.0000000000E+00  <span class="m">7</span>.0710678119E-01  <span class="m">7</span>.0710678119E-01
              <span class="m">7</span>.0710678119E-01  <span class="m">0</span>.0000000000E+00  <span class="m">7</span>.0710678119E-01
              <span class="m">7</span>.0710678119E-01  <span class="m">7</span>.0710678119E-01  <span class="m">0</span>.0000000000E+00 

<span class="c1"># strain: eta_4 = 0.01</span>
acell2  <span class="m">7</span>.4858028  <span class="m">2</span>*7.44856
rprim2     <span class="m">0</span>.                     <span class="m">0</span>.70710678118654746    <span class="m">0</span>.70710678118654746 
           <span class="m">0</span>.70710236181059671    <span class="m">0</span>.00353551180905298    <span class="m">0</span>.70710236181059671 
           <span class="m">0</span>.70710236181059671    <span class="m">0</span>.70710236181059671    <span class="m">0</span>.00353551180905298

<span class="c1"># strain: eta_4 = -0.01     2*7.44856</span>
acell3  <span class="m">7</span>.4113172  <span class="m">2</span>*7.44856
rprim3     <span class="m">0</span>.                     <span class="m">0</span>.70710678118654757    <span class="m">0</span>.70710678118654757
           <span class="m">0</span>.70710236181059671   -0.00353551180905298    <span class="m">0</span>.70710236181059671 
           <span class="m">0</span>.70710236181059671    <span class="m">0</span>.70710236181059671   -0.00353551180905298



<span class="c1">#Definition of the atoms</span>
<span class="c1">#***********************</span>
   natom <span class="m">2</span>
   ntypat <span class="m">2</span>
   znucl <span class="m">13</span> <span class="m">33</span>
   typat <span class="m">1</span> <span class="m">2</span>
   ixc <span class="m">3</span>
   xred   <span class="m">0</span>.00  <span class="m">0</span>.00  <span class="m">0</span>.00
          <span class="m">0</span>.25  <span class="m">0</span>.25  <span class="m">0</span>.25

<span class="c1">#Definition of the SCF procedure</span>
<span class="c1">#*******************************</span>
   nstep <span class="m">100</span>


<span class="c1">#Definition of the plane wave basis set</span>
<span class="c1">#**************************************</span>
   ecut  <span class="m">2</span>.8
   ecutsm <span class="m">0</span>.5
   dilatmx <span class="m">1</span>.05
   ngkpt <span class="m">6</span> <span class="m">6</span> <span class="m">6</span>
   nshiftk <span class="m">4</span>
   shiftk <span class="m">0</span>.5 <span class="m">0</span>.5 <span class="m">0</span>.5
          <span class="m">0</span>.5 <span class="m">0</span>.0 <span class="m">0</span>.0
          <span class="m">0</span>.0 <span class="m">0</span>.5 <span class="m">0</span>.0
          <span class="m">0</span>.0 <span class="m">0</span>.0 <span class="m">0</span>.5
   toldfe <span class="m">1</span>.0d-12

<span class="c1"># Berry phase calculation of the polarization</span>
<span class="c1">#********************************************</span>
   berryopt -1
   rfdir <span class="m">1</span> <span class="m">1</span> <span class="m">1</span>



<span class="c1">## After modifying the following section, one might need to regenerate the pickle database with runtests.py -r</span>
<span class="c1">#%%&lt;BEGIN TEST_INFO&gt;</span>
<span class="c1">#%% [setup]</span>
<span class="c1">#%% executable = abinit</span>
<span class="c1">#%% [files]</span>
<span class="c1">#%% files_to_test = </span>
<span class="c1">#%%   tffield_4.out, tolnlines=  0, tolabs=  0.000e+00, tolrel=  0.000e+00</span>
<span class="c1">#%% psp_files =  13al.pspnc, 33as.pspnc</span>
<span class="c1">#%% [paral_info]</span>
<span class="c1">#%% max_nprocs = 2</span>
<span class="c1">#%% [extra_info]</span>
<span class="c1">#%% authors = M. Veithen</span>
<span class="c1">#%% keywords = NC, DFPT</span>
<span class="c1">#%% description = </span>
<span class="c1">#%%  Finite difference calculation of the clamped-ion</span>
<span class="c1">#%%  piezoelectric constants of AlAs</span>
<span class="c1">#%%&lt;END TEST_INFO&gt;</span>
</pre></div>
</div></div>

<script> $(function() { abidocs_jqueryui_dialog("#uuid-a4606b4a-0070-4f97-a03e-6a8159fdeb97", "#uuid-452fdb90-6171-410a-bf2f-adf555187f3c") }); </script>

<div id="uuid-9acf06fd-818c-468a-ae6f-9986b3bda91c" class="my_dialog" title="tests/tutorespfn/Input/tffield_5.in" hidden><div><div class="codehilite small-text"><pre><span></span><span class="c1"># Finite difference calculation of the clamped-ion</span>
<span class="c1"># piezoelectric constants of AlAs</span>
<span class="c1"># (M. Veithen, 3.5.2005)</span>

ndtset <span class="m">3</span>

<span class="c1"># strain: eta_4 = 0.00</span>
acell1  <span class="m">3</span>*7.44856
rprim1        <span class="m">0</span>.0000000000E+00  <span class="m">7</span>.0710678119E-01  <span class="m">7</span>.0710678119E-01
              <span class="m">7</span>.0710678119E-01  <span class="m">0</span>.0000000000E+00  <span class="m">7</span>.0710678119E-01
              <span class="m">7</span>.0710678119E-01  <span class="m">7</span>.0710678119E-01  <span class="m">0</span>.0000000000E+00 

<span class="c1"># strain: eta_4 = 0.01</span>
acell2  <span class="m">7</span>.4858028  <span class="m">2</span>*7.44856
rprim2     <span class="m">0</span>.                     <span class="m">0</span>.70710678118654746    <span class="m">0</span>.70710678118654746 
           <span class="m">0</span>.70710236181059671    <span class="m">0</span>.00353551180905298    <span class="m">0</span>.70710236181059671 
           <span class="m">0</span>.70710236181059671    <span class="m">0</span>.70710236181059671    <span class="m">0</span>.00353551180905298

<span class="c1"># strain: eta_4 = -0.01</span>
acell3  <span class="m">7</span>.4113172  <span class="m">2</span>*7.44856
rprim3     <span class="m">0</span>.                     <span class="m">0</span>.70710678118654757    <span class="m">0</span>.70710678118654757
           <span class="m">0</span>.70710236181059671   -0.00353551180905298    <span class="m">0</span>.70710236181059671 
           <span class="m">0</span>.70710236181059671    <span class="m">0</span>.70710236181059671   -0.00353551180905298



<span class="c1">#Definition of the atoms</span>
<span class="c1">#***********************</span>
   natom <span class="m">2</span>
   ntypat <span class="m">2</span>
   znucl <span class="m">13</span> <span class="m">33</span>
   typat <span class="m">1</span> <span class="m">2</span>
   ixc <span class="m">3</span>
   xred   <span class="m">0</span>.00  <span class="m">0</span>.00  <span class="m">0</span>.00
          <span class="m">0</span>.25  <span class="m">0</span>.25  <span class="m">0</span>.25

<span class="c1">#Definition of the SCF procedure</span>
<span class="c1">#*******************************</span>
   nstep <span class="m">8</span>


<span class="c1">#Definition of the plane wave basis set</span>
<span class="c1">#**************************************</span>
   ecut  <span class="m">2</span>.8
   ecutsm <span class="m">0</span>.5
   dilatmx <span class="m">1</span>.05
   ngkpt <span class="m">6</span> <span class="m">6</span> <span class="m">6</span>
   nshiftk <span class="m">4</span>
   shiftk <span class="m">0</span>.5 <span class="m">0</span>.5 <span class="m">0</span>.5
          <span class="m">0</span>.5 <span class="m">0</span>.0 <span class="m">0</span>.0
          <span class="m">0</span>.0 <span class="m">0</span>.5 <span class="m">0</span>.0
          <span class="m">0</span>.0 <span class="m">0</span>.0 <span class="m">0</span>.5
   toldfe <span class="m">5</span>.0d-14

<span class="c1"># Relaxation of atomic positions</span>
<span class="c1">#*******************************</span>
   optcell <span class="m">0</span>
   ionmov <span class="m">2</span>
   tolmxf <span class="m">1</span>.0d-5
   ntime <span class="m">13</span>

<span class="c1"># Berry phase calculation of the polarization</span>
<span class="c1">#********************************************</span>
   berryopt -1
   rfdir <span class="m">1</span> <span class="m">1</span> <span class="m">1</span>



<span class="c1">## After modifying the following section, one might need to regenerate the pickle database with runtests.py -r</span>
<span class="c1">#%%&lt;BEGIN TEST_INFO&gt;</span>
<span class="c1">#%% [setup]</span>
<span class="c1">#%% executable = abinit</span>
<span class="c1">#%% [files]</span>
<span class="c1">#%% files_to_test = </span>
<span class="c1">#%%   tffield_5.out, tolnlines=  4, tolabs=  1.100e-08, tolrel=  4.500e-04</span>
<span class="c1">#%% psp_files =  13al.pspnc, 33as.pspnc</span>
<span class="c1">#%% [paral_info]</span>
<span class="c1">#%% max_nprocs = 2</span>
<span class="c1">#%% [extra_info]</span>
<span class="c1">#%% authors = M. Veithen</span>
<span class="c1">#%% keywords = NC, DFPT</span>
<span class="c1">#%% description = </span>
<span class="c1">#%%   Finite difference calculation of the clamped-ion</span>
<span class="c1">#%%   piezoelectric constants of AlAs</span>
<span class="c1">#%%&lt;END TEST_INFO&gt;</span>
</pre></div>
</div></div>

<script> $(function() { abidocs_jqueryui_dialog("#uuid-9acf06fd-818c-468a-ae6f-9986b3bda91c", "#uuid-4d0992ac-5441-486a-843c-390f530e92a2") }); </script>

<p>Notice how in the relaxed ion case, the input file includes <a class="wikilink codevar-wikilink" href="../../variables/rlx#ionmov">ionmov</a>=2 and <a class="wikilink codevar-wikilink" href="../../variables/rlx#optcell">optcell</a>=0, in
order to relax the ion positions at fixed cell geometry. These calculations
should give the following final results (obtained by taking finite difference
expressions of the strains for different electric fields)</p>
<div class="codehilite"><pre><span></span>Proper piezoelectric constants(clamped ion)(Unit:c/m^2) = -0.6491
Proper piezoelectric constants(relaxed ion)(Unit:c/m^2) =  0.0430
</pre></div>


<p>For example, the clamped ion piezoelectric constant was obtained from tffield_4.out:</p>
<div class="codehilite"><pre><span></span> Polarization in cartesian coordinates (C/m^2):
 (the sum of the electronic and ionic Berry phase has been folded into [-1, 1])
     Electronic berry phase:       -0.230210983E-02   0.421672896E-02   0.421672896E-02
     Ionic:                        -0.154692152E+01  -0.155466099E+01  -0.155466099E+01  
     Total:                        -0.154922363E+01  -0.155044426E+01  -0.155044426E+01
</pre></div>


<p>and</p>
<div class="codehilite"><pre><span></span> Polarization in cartesian coordinates (C/m^2):
 (the sum of the electronic and ionic Berry phase has been folded into [-1, 1])
     Electronic berry phase:        0.106813038E-01   0.417466770E-02   0.417466770E-02
     Ionic:                        -0.154692152E+01  -0.153919172E+01  -0.153919172E+01  
     Total:                        -0.153624022E+01  -0.153501706E+01  -0.153501706E+01
</pre></div>


<p>The difference between -0.154922363E+01 (x-strain is +0.01) and
-0.153624022E+01 (x-strain is -0.01) gives the finite difference -0.012983,
that, divided by 0.02 (the change of strain) gives -0.6491, announced above.<br />
Using to <a class="wikilink codevar-wikilink" href="../../variables/basic#ecut">ecut</a>=5 gives</p>
<div class="codehilite"><pre><span></span>Proper piezoelectric constants(clamped ion)(Unit:c/m^2) = -0.6841215
Proper piezoelectric constants(relaxed ion)(Unit:c/m^2) =  0.0313915
</pre></div>


<p>in excellent agreement with the above-mentioned DFPT values.</p>
<h2 id="3-finite-electric-field-calculations">3 Finite electric field calculations<a class="headerlink" href="#3-finite-electric-field-calculations" title="Permanent link">&para;</a></h2>
<p>In this section, you will learn how to perform a calculation with a finite electric field.</p>
<p>You can now copy the file ~abinit/tests/tutorespfn/Input/tffield_6.in in Work-
ffield, and modify the tffield_x.files accordingly. </p>
<div class="text-center"><button type="button" id="uuid-5307bcc9-b032-49cf-a6d0-7d784ac51fe9" class="btn btn-default btn-labeled">
  <span class="btn-label"><i class="fa fa-window-restore" aria-hidden="true"></i></span>View tests/tutorespfn/Input/tffield_6.in
</button></div>

<div id="uuid-9925c3e8-5c54-4adc-a6c8-af770f3a863a" class="my_dialog" title="tests/tutorespfn/Input/tffield_6.in" hidden><div><div class="codehilite small-text"><pre><span></span><span class="c1"># Finite electric field calculation of alas at clamped atomic positions</span>
<span class="c1"># (M. Veithen, 04.5.2005)</span>

<span class="c1">#Definition of the elementary cell</span>
<span class="c1">#*********************************</span>
   acell <span class="m">3</span>*10.53
   rprim <span class="m">0</span>.0 <span class="m">0</span>.5 <span class="m">0</span>.5
         <span class="m">0</span>.5 <span class="m">0</span>.0 <span class="m">0</span>.5
         <span class="m">0</span>.5 <span class="m">0</span>.5 <span class="m">0</span>.0

<span class="c1">#Definition of the atoms</span>
<span class="c1">#***********************</span>
   natom <span class="m">2</span>
   ntypat <span class="m">2</span>
   znucl <span class="m">13</span> <span class="m">33</span>
   typat <span class="m">1</span> <span class="m">2</span>
   ixc <span class="m">3</span>
   xred  <span class="m">0</span>.00  <span class="m">0</span>.00  <span class="m">0</span>.00
         <span class="m">0</span>.25  <span class="m">0</span>.25  <span class="m">0</span>.25

<span class="c1">#Definition of the SCF procedure</span>
<span class="c1">#*******************************</span>
   nstep <span class="m">100</span>
   nband <span class="m">4</span>
   nbdbuf <span class="m">0</span>


<span class="c1">#Definition of the plane wave basis set</span>
<span class="c1">#**************************************</span>
   ecut  <span class="m">2</span>.8
   ecutsm <span class="m">0</span>.5
   dilatmx <span class="m">1</span>.05
   ngkpt <span class="m">6</span> <span class="m">6</span> <span class="m">6</span>
   nshiftk <span class="m">4</span>
   shiftk <span class="m">0</span>.5 <span class="m">0</span>.5 <span class="m">0</span>.5
          <span class="m">0</span>.5 <span class="m">0</span>.0 <span class="m">0</span>.0
          <span class="m">0</span>.0 <span class="m">0</span>.5 <span class="m">0</span>.0
          <span class="m">0</span>.0 <span class="m">0</span>.0 <span class="m">0</span>.5
   toldfe <span class="m">1</span>.0d-12


<span class="c1"># ndtset  11</span>
  ndtset   <span class="m">3</span>
jdtset  <span class="m">11</span>
        <span class="m">21</span>  <span class="c1"># 22  23  24  25     # The additional 8 values of the field have been suppressed to spare CPU time</span>
        <span class="m">31</span>  <span class="c1"># 32  33  34  35</span>

berryopt11 -1       rfdir11    <span class="m">1</span> <span class="m">1</span> <span class="m">1</span>

berryopt21  <span class="m">4</span>       efield21   <span class="m">0</span>.0001  <span class="m">0</span>.0001  <span class="m">0</span>.0001    getwfk21  <span class="m">11</span>
berryopt22  <span class="m">4</span>       efield22   <span class="m">0</span>.0002  <span class="m">0</span>.0002  <span class="m">0</span>.0002    getwfk22  <span class="m">21</span>
berryopt23  <span class="m">4</span>       efield23   <span class="m">0</span>.0003  <span class="m">0</span>.0003  <span class="m">0</span>.0003    getwfk23  <span class="m">22</span>
berryopt24  <span class="m">4</span>       efield24   <span class="m">0</span>.0004  <span class="m">0</span>.0004  <span class="m">0</span>.0004    getwfk24  <span class="m">23</span>
berryopt25  <span class="m">4</span>       efield25   <span class="m">0</span>.0005  <span class="m">0</span>.0005  <span class="m">0</span>.0005    getwfk25  <span class="m">24</span>

berryopt31  <span class="m">4</span>       efield31  -0.0001 -0.0001 -0.0001    getwfk31  <span class="m">11</span>
berryopt32  <span class="m">4</span>       efield32  -0.0002 -0.0002 -0.0002    getwfk32  <span class="m">31</span>
berryopt33  <span class="m">4</span>       efield33  -0.0003 -0.0003 -0.0003    getwfk33  <span class="m">32</span>
berryopt34  <span class="m">4</span>       efield34  -0.0004 -0.0004 -0.0004    getwfk34  <span class="m">33</span>
berryopt35  <span class="m">4</span>       efield35  -0.0005 -0.0005 -0.0005    getwfk35  <span class="m">34</span>



<span class="c1">## After modifying the following section, one might need to regenerate the pickle database with runtests.py -r</span>
<span class="c1">#%%&lt;BEGIN TEST_INFO&gt;</span>
<span class="c1">#%% [setup]</span>
<span class="c1">#%% executable = abinit</span>
<span class="c1">#%% [files]</span>
<span class="c1">#%% files_to_test = </span>
<span class="c1">#%%   tffield_6.out, tolnlines=  0, tolabs=  1.001e-04, tolrel=  5.000e-04, fld_options = -ridiculous</span>
<span class="c1">#%% psp_files =  13al.pspnc, 33as.pspnc</span>
<span class="c1">#%% [paral_info]</span>
<span class="c1">#%% max_nprocs = 2</span>
<span class="c1">#%% [extra_info]</span>
<span class="c1">#%% authors = M. Veithen</span>
<span class="c1">#%% keywords = NC, DFPT</span>
<span class="c1">#%% description = Finite electric field calculation of alas at clamped atomic positions</span>
<span class="c1">#%%&lt;END TEST_INFO&gt;</span>
</pre></div>
</div></div>

<script> $(function() { abidocs_jqueryui_dialog("#uuid-9925c3e8-5c54-4adc-a6c8-af770f3a863a", "#uuid-5307bcc9-b032-49cf-a6d0-7d784ac51fe9") }); </script>

<p>You can start the run immediately, it will take one minute on a PC 3GHz. 
It performs a finite field calculation at clamped atomic positions. You can look at this input file to
identify the features specific to the finite field calculation.</p>
<p>As general parameters, one has to specify <a class="wikilink codevar-wikilink" href="../../variables/basic#nband">nband</a>, <a class="wikilink codevar-wikilink" href="../../variables/gstate#nbdbuf">nbdbuf</a> and <a class="wikilink codevar-wikilink" href="../../variables/basic#kptopt">kptopt</a>:</p>
<div class="codehilite"><pre><span></span>        nband          4
        nbdbuf         0
        kptopt         1
</pre></div>


<p>As a first step (dataset 11), the code must perform a Berry phase calculation
in zero field. For that purpose, it is necessary to set the values of <a class="wikilink codevar-wikilink" href="../../variables/ffield#berryopt">berryopt</a> and <a class="wikilink codevar-wikilink" href="../../variables/dfpt#rfdir">rfdir</a>:</p>
<div class="codehilite"><pre><span></span>        berryopt11     -1
        rfdir11        1 1 1
</pre></div>


<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>You cannot use berryopt to +1 to initiate a finite field calculation. 
You must begin with berryopt -1.</p>
</div>
<p>After that, there are different steps corresponding to various value of the
electric field, thanks to <a class="wikilink codevar-wikilink" href="../../variables/ffield#efield">efield</a>. For those steps, it is important to take
care of the following parameters, shown here for dataset 21:</p>
<div class="codehilite"><pre><span></span>        berryopt21     4
        efield21       0.0001  0.0001  0.0001
        getwfk21       11
</pre></div>


<p>The electric field is applied here along the [111] direction. It must be
incremented step by step (it is not possible to go to high field directly). At
each step, the wavefunctions of the previous step must be used. When the field
gets larger, it is important to check that it does not significantly exceed
the critical field for Zener breakthrough (the drop of potential over the
Born-von Karmann supercell must be smaller than the gap). In practice, the
number of k-point must be enlarged to reach convergence. However, at the same
time, the critical field becomes smaller. In practice, reasonable fields can
still be reached for k-point grids providing a reasonable degree of
convergence. A compromise must however be found.</p>
<p>As these calculations are quite long, the input file has been limited to very
small fields. Three cases have been selected: E = 0, E = +0.0001 and E = -0.0001. 
If you have time later, you can relax this constraint and perform a
more exhaustive calculations for a larger set of fields.</p>
<p>You can now start the run. Various quantities can be extracted from the finite
field calculation at clamped ions using finite difference techniques: the Born
Effective Charge Z* can be extracted from the forces, the optical dielectric
constant can be deduced from the polarization, and the clamped ion
piezoelectric tensor can be deduced from the stress tensor. As an illustration
we will focus here on the computation of Z*.</p>
<p>You can look at your output file. For each field, the file contains various
quantities that can be collected. For the present purpose, we can look at the
evolution of the forces with the field and extract the following results from
the output file:</p>
<p>E=0</p>
<div class="codehilite"><pre><span></span>cartesian forces (hartree/bohr) at end:
    1      0.00000000000000     0.00000000000000     0.00000000000000
    2      0.00000000000000     0.00000000000000     0.00000000000000
</pre></div>


<p>E = +0.0001</p>
<div class="codehilite"><pre><span></span>cartesian forces (hartree/bohr) at end:
    1      0.00020614766286     0.00020614766286     0.00020614766286
    2     -0.00020614766286    -0.00020614766286    -0.00020614766286
</pre></div>


<p>E = -0.0001</p>
<div class="codehilite"><pre><span></span>cartesian forces (hartree/bohr) at end:
    1     -0.00020651242444    -0.00020651242444    -0.00020651242444
    2      0.00020651242444     0.00020651242444     0.00020651242444
</pre></div>


<p>In a finite electric field, the force on atom A in direction i can be written as:</p>
<div class="codehilite"><pre><span></span>F_Ai = Z*_A,ii * E + \Omega_0 dchi/dtau E^2
</pre></div>


<p>The value for positive and negative fields above are nearly the same, showing
that the quadratic term is almost negligible. This clearly appears in the
figure below where the field dependence of the force for a larger range of
electric fields is plotted.</p>
<p><img alt="" src="../nlo_assets/image001.gif" /></p>
<p>We can therefore extract with a good accuracy the Born effective charge as :</p>
<div class="codehilite"><pre><span></span>Z*_Al    = (F_Al[E=+0.0001] - F_Al[E=-0.0001])/(2*0.0001)
         = (0.00020614766286 + 0.00020651242444)/0.0002
         = 2.06
</pre></div>


<p>This value is similar to the value reported from DFPT. If you do calculations
for more electric fields, fitting them with the general expression of the
force above (including the E^2 term), you can find the dchi/dtau term. At
<a class="wikilink codevar-wikilink" href="../../variables/basic#ecut">ecut</a>=5 you should get dchi/dtau for Al = -0.06169. This will be useful
later for the <a href="../nlo">lesson on static Non-linear properties</a>.</p>
<p>Going back to the output file, you can also look at the evolution of the
polarization with the field.</p>
<p>E = 0</p>
<div class="codehilite"><pre><span></span>Polarization in cartesian coordinates (a.u.):
 (the sum of the electronic and ionic Berry phase has been folded into [-1, 1])
     Electronic:  0.730822547E-04   0.730822547E-04   0.730822547E-04
     Ionic:      -0.270560574E-01  -0.270560574E-01  -0.270560574E-01  
     Total:      -0.269829752E-01  -0.269829752E-01  -0.269829752E-01
</pre></div>


<p>E = +0.0001</p>
<div class="codehilite"><pre><span></span>Polarization in cartesian coordinates (a.u.):
 (the sum of the electronic and ionic Berry phase has been folded into [-1, 1])
     Electronic:  0.129869845E-03   0.129869845E-03   0.129869844E-03
     Ionic:      -0.270560574E-01  -0.270560574E-01  -0.270560574E-01  
     Total:      -0.269261876E-01  -0.269261876E-01  -0.269261876E-01
</pre></div>


<p>E = -0.0001</p>
<div class="codehilite"><pre><span></span>Polarization in cartesian coordinates (a.u.):
 (the sum of the electronic and ionic Berry phase has been folded into [-1, 1])
     Electronic:  0.163575018E-04   0.163575016E-04   0.163575014E-04
     Ionic:      -0.270560574E-01  -0.270560574E-01  -0.270560574E-01  
     Total:      -0.270396999E-01  -0.270396999E-01  -0.270396999E-01
</pre></div>


<p>In a finite electric field, the polarization in terms of the linear and
quadratic susceptibilities as</p>
<div class="codehilite"><pre><span></span>P = \chi * E + \chi(2)  E^2
</pre></div>


<p>The change of polarization for positive and negative fields above are nearly
the same, showing again that the quadratic term is almost negligible. This
clearly appears in the figure below where the field dependence of the
polarization for a larger range of electric fields is plotted.</p>
<p><img alt="" src="../ffield_assets/image004.gif" /></p>
<p>We can therefore extract with a good accuracy the linear optical dielectric susceptibility:</p>
<div class="codehilite"><pre><span></span>\chi(l)_11 = (P[E=+0.0001] - P[E=-0.0001])/(2*0.0001)
           = (-0.269261876E-01+ 0.270396999E-01)/0.0002
           = 0.56756
</pre></div>


<p>The optical dielectric constant is:</p>
<div class="codehilite"><pre><span></span>\epsilon_11 = 1+ 4 \pi \chi(1)_11
           = 8.13
</pre></div>


<p>This value underestimates the value of 9.20 obtained by DFPT. The agreement is
not better at <a class="wikilink codevar-wikilink" href="../../variables/basic#ecut">ecut</a>=5. Typically, finite field calculations converge with
the density of the k point grid more slowly than DFPT calculations.</p>
<p>If you do calculations for more electric fields, fitting them with the general
expression of the force above (including the E^2 term) you can find the non-
linear optical susceptibilities \chi(2). At <a class="wikilink codevar-wikilink" href="../../variables/basic#ecut">ecut</a>=5 you should get \chi(2)
= 29.769 pm/V. This result will be also be useful for the <a href="../nlo">lesson on static Non-linear properties</a>.</p>
<p>Looking at the evolution of the stress (see graphic below), you should also be
able to extract the piezoelectric constants. You can try to do it as an
exercise. As the calculation here was at clamped ions, you will get the
clamped ion proper piezoelectric constants. At <a class="wikilink codevar-wikilink" href="../../variables/basic#ecut">ecut</a>=5, you should obtain -0.69088 C/m^2.</p>
<p><img alt="" src="../ffield_assets/image007.gif" /></p>
<p>Redoing the same kind of finite field calculation when allowing the ions to
relax, one can access the relaxed ion proper piezoelectric constant. 
At <a class="wikilink codevar-wikilink" href="../../variables/basic#ecut">ecut</a>=5 the result is -0.03259.</p>
                
                  
                
              

<!-- 
add dropdown button with toolbar (based on https://bootsnipp.com/snippets/featured/inbox-by-gmail)
and return to Top button (based on https://codepen.io/rdallaire/pen/apoyx)
-->
<div class="md-container">
  <div class="row">
    <div id="inbox">
      <div class="fab btn-group show-on-hover dropup">
        <div data-toggle="tooltip" data-placement="left" title="Menu" style="margin-left: 42px;">
          <button id="return-to-top" type="button" class="btn btn-primary btn-io dropdown-toggle" data-toggle="dropdown">
            <span class="fa-stack fa-2x">
                <i class="fa fa-circle fa-stack-2x fab-backdrop"></i>
                <i class="fa fa-chevron-up fa-stack-1x fa-inverse fab-primary"></i>
                <i class="fa fa-map-signs fa-stack-1x fa-inverse fab-secondary"></i>
            </span>
          </button>
        </div>
        <ul class="dropdown-menu dropdown-menu-right" role="menu">
        
        
          <li><a href="../../about/release-notes/" data-toggle="tooltip" data-placement="left" 
                  title="About"><i class="fa fa-info-circle"></i></a></li>
        
          <li><a href="../../developers/abimkdocs/" data-toggle="tooltip" data-placement="left" 
                  title="Developers"><i class="fa fa-terminal"></i></a></li>
        
          <li><a href="../../theory/geometry/" data-toggle="tooltip" data-placement="left" 
                  title="Theory"><i class="fa fa-book"></i></a></li>
        
          <li><a href="../" data-toggle="tooltip" data-placement="left" 
                  title="Lessons"><i class="fa fa-graduation-cap"></i></a></li>
        
          <li><a href="../../variables/" data-toggle="tooltip" data-placement="left" 
                  title="Variables"><i class="fa fa-file-text-o"></i></a></li>
        
          <li><a href="../../topics/features/" data-toggle="tooltip" data-placement="left" 
                  title="Topics"><i class="fa fa-question"></i></a></li>
        
          <li><a href="../.." data-toggle="tooltip" data-placement="left" 
                  title="User Guide"><i class="fa fa-user-circle-o"></i></a></li>
        
        <!--
        Example: 
        <li><a href="/index.html" data-toggle="tooltip" data-placement="left" title="User-Guide">
              <i class="fa fa-user-circle-o"></i></a></li>
        -->
        </ul>
      </div>
    </div>
  </div>
</div>

              
                
              
            </article>
          </div>
        </div>
      </main>
      
    <!-- Add tabs to footer -->
    
        

  

<nav class="md-tabs md-tabs--active" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../.." title="User Guide" class="md-tabs__link">
          User Guide
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../topics/features/" title="Topics" class="md-tabs__link">
          Topics
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../variables/" title="Variables" class="md-tabs__link">
          Variables
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../" title="Lessons" class="md-tabs__link md-tabs__link--active">
          Lessons
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../theory/geometry/" title="Theory" class="md-tabs__link">
          Theory
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../developers/abimkdocs/" title="Developers" class="md-tabs__link">
          Developers
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../about/release-notes/" title="About" class="md-tabs__link">
          About
        </a>
      
    </li>
  

      
    </ul>
  </div>
</nav>
    
    
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../elastic/" title="Elastic" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Elastic
              </span>
            </div>
          </a>
        
        
          <a href="../nlo/" title="Nlo" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Nlo
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
            <center>Abinit version 8.8.4</center>
        
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2018 The Abinit Group (PhG, MVeithen, XG)
          </div>
        
        powered by
        <a href="http://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
  <div class="md-footer-social">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    
      <a href="https://github.com/abinit/abinit" class="md-footer-social__link fa fa-github-alt"></a>
    
      <a href="https://twitter.com/hashtag/abinit" class="md-footer-social__link fa fa-twitter"></a>
    
      <a href="http://www.facebook.com/abinit.org" class="md-footer-social__link fa fa-facebook"></a>
    
      <a href="https://www.youtube.com/watch?v=gcbfb_Mteo4" class="md-footer-social__link fa fa-youtube"></a>
    
  </div>

      
    </div>
  </div>
</footer>
      

    </div>
    
      <script src="../../assets/javascripts/application.02434462.js"></script>
      
      <script>app.initialize({version:"0.17.2",url:{base:"../.."}})</script>
      
        <script src="../../extra_javascript/jquery.dialogextend.min.js"></script>
      
        <script src="../../extra_javascript/abidocs.js"></script>
      
    
    
      
        <script>!function(e,a,t,n,o,c,i){e.GoogleAnalyticsObject=o,e.ga=e.ga||function(){(e.ga.q=e.ga.q||[]).push(arguments)},e.ga.l=1*new Date,c=a.createElement(t),i=a.getElementsByTagName(t)[0],c.async=1,c.src="https://www.google-analytics.com/analytics.js",i.parentNode.insertBefore(c,i)}(window,document,"script",0,"ga"),ga("create","UA-116681470-1","docs.abinit.org"),ga("set","anonymizeIp",!0),ga("send","pageview");var links=document.getElementsByTagName("a");if(Array.prototype.map.call(links,function(e){e.host!=document.location.host&&e.addEventListener("click",function(){var a=e.getAttribute("data-md-action")||"follow";ga("send","event","outbound",a,e.href)})}),document.forms.search){var query=document.forms.search.query;query.addEventListener("blur",function(){if(this.value){var e=document.location.pathname;ga("send","pageview",e+"?q="+this.value)}})}</script>
      
    
  </body>
</html>